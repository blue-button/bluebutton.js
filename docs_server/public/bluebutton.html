<!DOCTYPE html>
<head>
  <title>Blue Button</title>
</head>
<body>
  <pre id="result"></pre>
  <textarea id="xml" style="display:none">
<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type='text/xsl' href='/Greenway-CCD.xsl'?>
<ClinicalDocument xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:voc="urn:hl7-org:v3/voc" xmlns="urn:hl7-org:v3">
  <realmCode code="US"/>
  <typeId root="2.16.840.1.113883.1.3" extension="POCD_HD000040"/>
  <templateId root="2.16.840.1.113883.10.20.22.1.1"/>
  <templateId root="2.16.840.1.113883.10.20.22.1.2"/>
  <id root="2.16.840.1.113883.3.441" extension="7c4d0c7819714db6a4737ca1d35faa7a"/>
  <code code="34133-9" displayName="Summarization of episode note" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
  <title>MU2 Referral Summary</title>
  <effectiveTime value="20130319092853-0400"/>
  <confidentialityCode code="N" displayName="Normal" codeSystem="2.16.840.1.113883.5.25" codeSystemName="Confidentiality"/>
  <languageCode code="en-US"/>
  <setId root="2.16.840.1.113883.3.441" extension="1"/>
  <versionNumber value="1"/>
  <recordTarget typeCode="RCT" contextControlCode="OP">
    <patientRole classCode="PAT">
      <id root="2.16.840.1.113883.3.441.1.50.300011.51" extension="26604"/>
      <addr>
        <streetAddressLine nullFlavor="UNK"/>
        <streetAddressLine nullFlavor="UNK"/>
        <city nullFlavor="UNK"/>
        <state>GA</state>
        <postalCode nullFlavor="UNK"/>
        <country>US</country>
      </addr>
      <telecom use="HP" nullFlavor="UNK"/>
      <patient classCode="PSN" determinerCode="INSTANCE">
        <name>
          <given>Adam</given>
          <family>Everyman</family>
        </name>
        <administrativeGenderCode code="M" displayName="Male" codeSystem="2.16.840.1.113883.5.1" codeSystemName="Administrative Gender Code"/>
        <birthTime value="19621022"/>
        <maritalStatusCode code="S" displayName="Never Married" codeSystem="2.16.840.1.113883.5.2" codeSystemName="HL7v3 Marital Status Value Set"/>
        <raceCode code="2106-3" displayName="White" codeSystem="2.16.840.1.113883.6.238" codeSystemName="CDC Race Code Value Set"/>
        <ethnicGroupCode code="2135-2" displayName="Hispanic or Latino" codeSystem="2.16.840.1.113883.6.238" codeSystemName="OMB Standards for Race and Ethnicity"/>
        <languageCommunication>
          <languageCode code="eng"/>
        </languageCommunication>
      </patient>
      <providerOrganization classCode="ORG" determinerCode="INSTANCE">
        <id root="2.16.840.1.113883.3.441.1.50" extension="300011"/>
        <name>Get Well Clinic</name>
        <telecom use="WP" value="555-555-1004"/>
        <addr>
          <streetAddressLine>1004 Healthcare Dr. practice</streetAddressLine>
          <streetAddressLine nullFlavor="UNK"/>
          <city>Portland</city>
          <state>OR</state>
          <postalCode>97005</postalCode>
          <country>United States</country>
        </addr>
      </providerOrganization>
    </patientRole>
  </recordTarget>
  <author typeCode="AUT" contextControlCode="OP">
    <time nullFlavor="UNK"/>
    <assignedAuthor classCode="ASSIGNED">
      <id root="2.16.840.1.113883.4.6" extension="452ecc6ad462460bb535bc226fc7f612"/>
      <addr>
        <streetAddressLine>1004 Healthcare Dr. practice</streetAddressLine>
        <streetAddressLine nullFlavor="UNK"/>
        <city>Portland</city>
        <state>OR</state>
        <postalCode>97005</postalCode>
        <country>United States</country>
      </addr>
      <telecom use="WP" value="555-555-1004"/>
      <assignedPerson classCode="PSN" determinerCode="INSTANCE">
        <name nullFlavor="UNK"/>
      </assignedPerson>
      <representedOrganization>
        <id root="2.16.840.1.113883.3.441.1.50" extension="300011"/>
        <name>Get Well Clinic</name>
        <telecom use="WP" value="555-555-1004"/>
        <addr>
          <streetAddressLine>1004 Healthcare Dr. practice</streetAddressLine>
          <streetAddressLine nullFlavor="UNK"/>
          <city>Portland</city>
          <state>OR</state>
          <postalCode>97005</postalCode>
          <country>United States</country>
        </addr>
      </representedOrganization>
    </assignedAuthor>
  </author>
  <informant>
    <assignedEntity>
      <id nullFlavor="NA"/>
      <addr>
        <streetAddressLine>1004 Healthcare Dr. practice</streetAddressLine>
        <streetAddressLine nullFlavor="UNK"/>
        <city>Portland</city>
        <state>OR</state>
        <postalCode>97005</postalCode>
        <country>United States</country>
      </addr>
      <telecom use="WP" value="555-555-1004"/>
      <assignedPerson classCode="PSN" determinerCode="INSTANCE">
        <name nullFlavor="UNK"/>
      </assignedPerson>
      <representedOrganization>
        <id root="2.16.840.1.113883.3.441.1.50" extension="300011"/>
        <name>Get Well Clinic</name>
        <telecom use="WP" value="555-555-1004"/>
        <addr>
          <streetAddressLine>1004 Healthcare Dr. practice</streetAddressLine>
          <streetAddressLine nullFlavor="UNK"/>
          <city>Portland</city>
          <state>OR</state>
          <postalCode>97005</postalCode>
          <country>United States</country>
        </addr>
      </representedOrganization>
    </assignedEntity>
  </informant>
  <custodian typeCode="CST">
    <assignedCustodian classCode="ASSIGNED">
      <representedCustodianOrganization classCode="ORG" determinerCode="INSTANCE">
        <id root="2.16.840.1.113883.3.441.1.50" extension="300011"/>
        <name>Get Well Clinic</name>
        <telecom use="WP" value="555-555-1004"/>
        <addr>
          <streetAddressLine>1004 Healthcare Dr. practice</streetAddressLine>
          <streetAddressLine nullFlavor="UNK"/>
          <city>Portland</city>
          <state>OR</state>
          <postalCode>97005</postalCode>
          <country>United States</country>
        </addr>
      </representedCustodianOrganization>
    </assignedCustodian>
  </custodian>
  <documentationOf typeCode="DOC">
    <serviceEvent classCode="PCPR" moodCode="EVN">
      <effectiveTime nullFlavor="UNK">
        <low nullFlavor="UNK"/>
        <high nullFlavor="UNK"/>
      </effectiveTime>
      <performer typeCode="PRF">
        <templateId root="2.16.840.1.113883.3.88.11.83.4"/>
        <templateId root="1.3.6.1.4.1.19376.1.5.3.1.2.3"/>
        <functionCode code="PP" displayName="Primary CareProvider" codeSystem="2.16.840.1.113883.12.443" codeSystemName="Provider Role"/>
        <time nullFlavor="UNK">
          <low nullFlavor="UNK"/>
          <high nullFlavor="UNK"/>
        </time>
        <assignedEntity>
          <id root="2.16.840.1.113883.4.6" extension="UNK"/>
          <addr nullFlavor="UNK"/>
          <telecom use="WP" nullFlavor="UNK"/>
          <assignedPerson classCode="PSN" determinerCode="INSTANCE">
            <name nullFlavor="UNK"/>
          </assignedPerson>
        </assignedEntity>
      </performer>
      <performer typeCode="PRF">
        <templateId root="2.16.840.1.113883.3.88.11.83.4"/>
        <templateId root="1.3.6.1.4.1.19376.1.5.3.1.2.3"/>
        <assignedEntity>
          <id root="2.16.840.1.113883.4.6" extension="UNK"/>
          <code code="-1" displayName="PCP" codeSystemName="GMTDynamic"/>
          <assignedPerson classCode="PSN" determinerCode="INSTANCE">
            <name>
              <given>Henry</given>
              <family>Seven, M.D.</family>
            </name>
          </assignedPerson>
        </assignedEntity>
      </performer>
    </serviceEvent>
  </documentationOf>
  <component>
    <structuredBody classCode="DOCBODY" moodCode="EVN">
      <templateId root="2.16.840.1.113883.10" extension="MPL_CDAR2_LEVEL1-2REF_US_I2_2005SEP"/>
      <component>
        <section classCode="DOCSECT" moodCode="EVN">
          <templateId root="1.3.6.1.4.1.19376.1.5.3.1.3.1"/>
          <id root="2.16.840.1.113883.3.441" extension="a157f447c97b4b97"/>
          <code code="42349-1" displayName="REASON FOR REFERRAL" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
          <title>Reason for Referral</title>
          <text mediaType="text/x-hl7-text+xml">
            <table border="1">
              <thead>
                <tr>
                  <th>Reason for Referral</th>
                  <th>Plan Date</th>
                  <th>Provider</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td ID="ref_84e253edbb6f425cab7e177170e9cf18_referral_1_reason">Pulmonary Function Testing</td>
                  <td ID="ref_84e253edbb6f425cab7e177170e9cf18_referral_1_planDate"/>
                  <td ID="ref_84e253edbb6f425cab7e177170e9cf18_referral_1_provider"> Penny Puffer, 1047 Healthcare Drive, , Portland, OR, 97005, 555-555-1049</td>
                </tr>
                <tr>
                  <td ID="ref_84e253edbb6f425cab7e177170e9cf18_referral_2_reason">test</td>
                  <td ID="ref_84e253edbb6f425cab7e177170e9cf18_referral_2_planDate">4/2/2013</td>
                  <td ID="ref_84e253edbb6f425cab7e177170e9cf18_referral_2_provider"> Direct Test , , , , , , </td>
                </tr>
                <tr>
                  <td ID="ref_84e253edbb6f425cab7e177170e9cf18_referral_3_reason">r</td>
                  <td ID="ref_84e253edbb6f425cab7e177170e9cf18_referral_3_planDate"/>
                  <td ID="ref_84e253edbb6f425cab7e177170e9cf18_referral_3_provider"> 14605 FirstName 14605 LastName, 28217 AddressLine1, 28217 AddressLine2, 28217 City, , 00000, 555-555-7993</td>
                </tr>
              </tbody>
            </table>
          </text>
        </section>
      </component>
      <component>
        <section classCode="DOCSECT" moodCode="EVN">
          <templateId root="2.16.840.1.113883.10.20.22.2.6.1"/>
          <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.57" extension="a1365fb1f2a541a1"/>
          <code code="48765-2" displayName="Allergies, adverse reactions, alerts" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
          <title>Allergies and Adverse Reactions</title>
          <text mediaType="text/x-hl7-text+xml">
            <table border="1">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Reaction</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td ID="ref_c6e54337be0d4491baf17263b2318c09_allergy_name_1">codeine sulfate</td>
                  <td ID="ref_c6e54337be0d4491baf17263b2318c09_allergy_reaction_1">swelling</td>
                  <td ID="ref_c6e54337be0d4491baf17263b2318c09_allergy_comment_1">active</td>
                </tr>
                <tr>
                  <td ID="ref_c6e54337be0d4491baf17263b2318c09_allergy_name_2">penicillin G benzathine</td>
                  <td ID="ref_c6e54337be0d4491baf17263b2318c09_allergy_reaction_2">hives</td>
                  <td ID="ref_c6e54337be0d4491baf17263b2318c09_allergy_comment_2">active</td>
                </tr>
                <tr>
                  <td ID="ref_c6e54337be0d4491baf17263b2318c09_allergy_name_3">aspirin</td>
                  <td ID="ref_c6e54337be0d4491baf17263b2318c09_allergy_reaction_3">shortness of breath</td>
                  <td ID="ref_c6e54337be0d4491baf17263b2318c09_allergy_comment_3">active</td>
                </tr>
              </tbody>
            </table>
          </text>
          <entry>
            <act classCode="ACT" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.30"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.57" extension="1310"/>
              <code code="48765-2" displayName="Allergies, adverse reactions, alerts" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
              <statusCode code="active"/>
              <effectiveTime>
                <low nullFlavor="UNK"/>
              </effectiveTime>
              <entryRelationship typeCode="SUBJ" inversionInd="true">
                <observation classCode="OBS" moodCode="EVN" negationInd="false">
                  <templateId root="2.16.840.1.113883.10.20.22.4.7"/>
                  <id root="2.16.840.1.113883.3.441" extension="f53fcb22dab24fe493ced847fe8ae85c"/>
                  <code code="ASSERTION" codeSystem="2.16.840.1.113883.5.4"/>
                  <statusCode code="completed"/>
                  <effectiveTime>
                    <low nullFlavor="UNK"/>
                  </effectiveTime>
                  <value xsi:type="CD" code="419199007" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT" displayName="Allergy to substance (disorder)"/>
                  <participant typeCode="CSM">
                    <time nullFlavor="UNK"/>
                    <participantRole classCode="MANU">
                      <addr nullFlavor="UNK"/>
                      <telecom use="" nullFlavor="UNK"/>
                      <playingEntity classCode="MMAT" determinerCode="INSTANCE">
                        <code nullFlavor="NA">
                          <originalText>
                            <reference value="#ref_c6e54337be0d4491baf17263b2318c09_allergy_name_1"/>
                          </originalText>
                        </code>
                        <name>codeine sulfate</name>
                      </playingEntity>
                    </participantRole>
                  </participant>
                  <entryRelationship typeCode="MFST" inversionInd="true">
                    <observation classCode="OBS" moodCode="EVN" negationInd="false">
                      <templateId root="2.16.840.1.113883.10.20.22.4.9"/>
                      <id root="2.16.840.1.113883.3.441" extension="5b5fec5f67784cbdaea594209759be86"/>
                      <code code="ASSERTION" codeSystem="2.16.840.1.113883.5.4"/>
                      <text>swelling<reference value="#ref_c6e54337be0d4491baf17263b2318c09_allergy_reaction_1"/></text>
                      <statusCode code="completed"/>
                      <effectiveTime nullFlavor="UNK">
                        <low nullFlavor="UNK"/>
                        <high nullFlavor="UNK"/>
                      </effectiveTime>
                      <value xsi:type="CD" nullFlavor="OTH"/>
                    </observation>
                  </entryRelationship>
                  <entryRelationship typeCode="SUBJ" inversionInd="true">
                    <act classCode="ACT" moodCode="EVN">
                      <templateId root="2.16.840.1.113883.10.20.1.40"/>
                      <templateId root="1.3.6.1.4.1.19376.1.5.3.1.4.2"/>
                      <code code="48767-8" displayName="Annotation Comment" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                      <text>
                        <reference value="#ref_c6e54337be0d4491baf17263b2318c09_allergy_comment_1"/>
                      </text>
                      <statusCode code="completed"/>
                    </act>
                  </entryRelationship>
                  <entryRelationship typeCode="REFR" inversionInd="true">
                    <observation classCode="OBS" moodCode="EVN">
                      <templateId root="2.16.840.1.113883.10.20.22.4.28"/>
                      <code code="33999-4" displayName="Status" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                      <statusCode code="completed"/>
                      <value xsi:type="CE" code="55561003" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT" displayName="Active"/>
                    </observation>
                  </entryRelationship>
                </observation>
              </entryRelationship>
            </act>
          </entry>
          <entry>
            <act classCode="ACT" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.30"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.57" extension="1311"/>
              <code code="48765-2" displayName="Allergies, adverse reactions, alerts" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
              <statusCode code="active"/>
              <effectiveTime>
                <low nullFlavor="UNK"/>
              </effectiveTime>
              <entryRelationship typeCode="SUBJ" inversionInd="true">
                <observation classCode="OBS" moodCode="EVN" negationInd="false">
                  <templateId root="2.16.840.1.113883.10.20.22.4.7"/>
                  <id root="2.16.840.1.113883.3.441" extension="9426d8a60b004ad4970a03700fd883fe"/>
                  <code code="ASSERTION" codeSystem="2.16.840.1.113883.5.4"/>
                  <statusCode code="completed"/>
                  <effectiveTime>
                    <low nullFlavor="UNK"/>
                  </effectiveTime>
                  <value xsi:type="CD" code="419199007" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT" displayName="Allergy to substance (disorder)"/>
                  <participant typeCode="CSM">
                    <time nullFlavor="UNK"/>
                    <participantRole classCode="MANU">
                      <addr nullFlavor="UNK"/>
                      <telecom use="" nullFlavor="UNK"/>
                      <playingEntity classCode="MMAT" determinerCode="INSTANCE">
                        <code code="215674" displayName="Bicillin L-A" codeSystem="2.16.840.1.113883.6.88" codeSystemName="RxNorm">
                          <originalText>
                            <reference value="#ref_c6e54337be0d4491baf17263b2318c09_allergy_name_2"/>
                          </originalText>
                          <translation code="3727" displayName="penicillin G benzathine" codeSystem="2.16.840.1.113883.6.64" codeSystemName="FDBDRUG"/>
                        </code>
                        <name>penicillin G benzathine</name>
                      </playingEntity>
                    </participantRole>
                  </participant>
                  <entryRelationship typeCode="MFST" inversionInd="true">
                    <observation classCode="OBS" moodCode="EVN" negationInd="false">
                      <templateId root="2.16.840.1.113883.10.20.22.4.9"/>
                      <id root="2.16.840.1.113883.3.441" extension="7580aa923ed141a7845b48c64cb41326"/>
                      <code code="ASSERTION" codeSystem="2.16.840.1.113883.5.4"/>
                      <text>hives<reference value="#ref_c6e54337be0d4491baf17263b2318c09_allergy_reaction_2"/></text>
                      <statusCode code="completed"/>
                      <effectiveTime nullFlavor="UNK">
                        <low nullFlavor="UNK"/>
                        <high nullFlavor="UNK"/>
                      </effectiveTime>
                      <value xsi:type="CD" nullFlavor="OTH"/>
                    </observation>
                  </entryRelationship>
                  <entryRelationship typeCode="SUBJ" inversionInd="true">
                    <act classCode="ACT" moodCode="EVN">
                      <templateId root="2.16.840.1.113883.10.20.1.40"/>
                      <templateId root="1.3.6.1.4.1.19376.1.5.3.1.4.2"/>
                      <code code="48767-8" displayName="Annotation Comment" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                      <text>
                        <reference value="#ref_c6e54337be0d4491baf17263b2318c09_allergy_comment_2"/>
                      </text>
                      <statusCode code="completed"/>
                    </act>
                  </entryRelationship>
                  <entryRelationship typeCode="REFR" inversionInd="true">
                    <observation classCode="OBS" moodCode="EVN">
                      <templateId root="2.16.840.1.113883.10.20.22.4.28"/>
                      <code code="33999-4" displayName="Status" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                      <statusCode code="completed"/>
                      <value xsi:type="CE" code="55561003" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT" displayName="Active"/>
                    </observation>
                  </entryRelationship>
                </observation>
              </entryRelationship>
            </act>
          </entry>
          <entry>
            <act classCode="ACT" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.30"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.57" extension="1312"/>
              <code code="48765-2" displayName="Allergies, adverse reactions, alerts" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
              <statusCode code="active"/>
              <effectiveTime>
                <low nullFlavor="UNK"/>
              </effectiveTime>
              <entryRelationship typeCode="SUBJ" inversionInd="true">
                <observation classCode="OBS" moodCode="EVN" negationInd="false">
                  <templateId root="2.16.840.1.113883.10.20.22.4.7"/>
                  <id root="2.16.840.1.113883.3.441" extension="86480d0297454cd889206de460dbc208"/>
                  <code code="ASSERTION" codeSystem="2.16.840.1.113883.5.4"/>
                  <statusCode code="completed"/>
                  <effectiveTime>
                    <low nullFlavor="UNK"/>
                  </effectiveTime>
                  <value xsi:type="CD" code="419199007" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT" displayName="Allergy to substance (disorder)"/>
                  <participant typeCode="CSM">
                    <time nullFlavor="UNK"/>
                    <participantRole classCode="MANU">
                      <addr nullFlavor="UNK"/>
                      <telecom use="" nullFlavor="UNK"/>
                      <playingEntity classCode="MMAT" determinerCode="INSTANCE">
                        <code code="1001473" displayName="Ecpirin" codeSystem="2.16.840.1.113883.6.88" codeSystemName="RxNorm">
                          <originalText>
                            <reference value="#ref_c6e54337be0d4491baf17263b2318c09_allergy_name_3"/>
                          </originalText>
                          <translation code="1076" displayName="aspirin" codeSystem="2.16.840.1.113883.6.64" codeSystemName="FDBDRUG"/>
                        </code>
                        <name>aspirin</name>
                      </playingEntity>
                    </participantRole>
                  </participant>
                  <entryRelationship typeCode="MFST" inversionInd="true">
                    <observation classCode="OBS" moodCode="EVN" negationInd="false">
                      <templateId root="2.16.840.1.113883.10.20.22.4.9"/>
                      <id root="2.16.840.1.113883.3.441" extension="b46032cac2554067be024a0dd2bdbfc2"/>
                      <code code="ASSERTION" codeSystem="2.16.840.1.113883.5.4"/>
                      <text>shortness of breath<reference value="#ref_c6e54337be0d4491baf17263b2318c09_allergy_reaction_3"/></text>
                      <statusCode code="completed"/>
                      <effectiveTime nullFlavor="UNK">
                        <low nullFlavor="UNK"/>
                        <high nullFlavor="UNK"/>
                      </effectiveTime>
                      <value xsi:type="CD" nullFlavor="OTH"/>
                    </observation>
                  </entryRelationship>
                  <entryRelationship typeCode="SUBJ" inversionInd="true">
                    <act classCode="ACT" moodCode="EVN">
                      <templateId root="2.16.840.1.113883.10.20.1.40"/>
                      <templateId root="1.3.6.1.4.1.19376.1.5.3.1.4.2"/>
                      <code code="48767-8" displayName="Annotation Comment" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                      <text>
                        <reference value="#ref_c6e54337be0d4491baf17263b2318c09_allergy_comment_3"/>
                      </text>
                      <statusCode code="completed"/>
                    </act>
                  </entryRelationship>
                  <entryRelationship typeCode="REFR" inversionInd="true">
                    <observation classCode="OBS" moodCode="EVN">
                      <templateId root="2.16.840.1.113883.10.20.22.4.28"/>
                      <code code="33999-4" displayName="Status" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                      <statusCode code="completed"/>
                      <value xsi:type="CE" code="55561003" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT" displayName="Active"/>
                    </observation>
                  </entryRelationship>
                </observation>
              </entryRelationship>
            </act>
          </entry>
        </section>
      </component>
      <component>
        <section classCode="DOCSECT" moodCode="EVN">
          <templateId root="2.16.840.1.113883.10.20.22.2.10"/>
          <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.72" extension="0a6e5328003c44f7"/>
          <code code="18776-5" displayName="Treatment Plan" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
          <title>Plan of Treatment</title>
          <text mediaType="text/x-hl7-text+xml">
            <table border="1">
              <thead>
                <tr>
                  <th>Planned Activity</th>
                  <th>Comments</th>
                  <th>Planned Date</th>
                  <th>Planned Time</th>
                  <th>Plan/Goal</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedActivity_1">Pulmonary Function Testing</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedComments_1"/>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedDate_1"/>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedTime_1"/>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedGoal_1"/>
                </tr>
                <tr>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedActivity_2">test</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedComments_2"/>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedDate_2">4/2/2013</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedTime_2">4:00 PM</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedGoal_2"/>
                </tr>
                <tr>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedActivity_3">r</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedComments_3"/>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedDate_3"/>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedTime_3"/>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedGoal_3"/>
                </tr>
                <tr>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedActivity_4">Smoking Cessation Plan</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedComments_4"/>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedDate_4">3/30/2012</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedTime_4">12:00 AM</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedGoal_4">Resources and instructions provided during visit</td>
                </tr>
                <tr>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedActivity_5">Smoking Cessation: Goal</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedComments_5"/>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedDate_5">3/30/2012</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedTime_5">12:00 AM</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedGoal_5">Quit smoking</td>
                </tr>
                <tr>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedActivity_6">Weight Loss Plan</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedComments_6"/>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedDate_6">3/30/2012</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedTime_6">12:00 AM</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedGoal_6">Resources and instructions provided during visit.</td>
                </tr>
                <tr>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedActivity_7">Weight Loss: Goal</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedComments_7"/>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedDate_7">3/30/2012</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedTime_7">12:00 AM</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedGoal_7">BMI &amp;lt; 25</td>
                </tr>
                <tr>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedActivity_8">Chest X-Ray, PA and Lateral Views; Body site: lower respiratory tract structure</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedComments_8"/>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedDate_8">1/24/2013</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedTime_8">12:00 AM</td>
                  <td ID="ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedGoal_8"/>
                </tr>
              </tbody>
            </table>
          </text>
          <entry>
            <observation classCode="OBS" moodCode="RQO">
              <templateId root="2.16.840.1.113883.10.20.22.4.44"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.72" extension="1160"/>
              <code nullFlavor="NA"/>
              <text>Pulmonary Function Testing<reference value="#ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedActivity_1"/></text>
              <statusCode code="new"/>
              <effectiveTime nullFlavor="UNK"/>
              <interpretationCode nullFlavor="NA"/>
            </observation>
          </entry>
          <entry>
            <observation classCode="OBS" moodCode="RQO">
              <templateId root="2.16.840.1.113883.10.20.22.4.44"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.72" extension="1166"/>
              <code nullFlavor="NA"/>
              <text>test<reference value="#ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedActivity_2"/></text>
              <statusCode code="new"/>
              <effectiveTime value="20130402"/>
              <interpretationCode nullFlavor="NA"/>
            </observation>
          </entry>
          <entry>
            <observation classCode="OBS" moodCode="RQO">
              <templateId root="2.16.840.1.113883.10.20.22.4.44"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.72" extension="1167"/>
              <code nullFlavor="NA"/>
              <text>r<reference value="#ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedActivity_3"/></text>
              <statusCode code="new"/>
              <effectiveTime nullFlavor="UNK"/>
              <interpretationCode nullFlavor="NA"/>
            </observation>
          </entry>
          <entry>
            <observation classCode="OBS" moodCode="RQO">
              <templateId root="2.16.840.1.113883.10.20.22.4.44"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.72" extension="2282"/>
              <code nullFlavor="NA"/>
              <text>Smoking Cessation Plan<reference value="#ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedActivity_4"/></text>
              <statusCode code="new"/>
              <effectiveTime value="20120330"/>
              <interpretationCode nullFlavor="NA"/>
            </observation>
          </entry>
          <entry>
            <observation classCode="OBS" moodCode="RQO">
              <templateId root="2.16.840.1.113883.10.20.22.4.44"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.72" extension="2283"/>
              <code nullFlavor="NA"/>
              <text>Smoking Cessation: Goal<reference value="#ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedActivity_5"/></text>
              <statusCode code="new"/>
              <effectiveTime value="20120330"/>
              <interpretationCode nullFlavor="NA"/>
            </observation>
          </entry>
          <entry>
            <observation classCode="OBS" moodCode="RQO">
              <templateId root="2.16.840.1.113883.10.20.22.4.44"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.72" extension="2284"/>
              <code nullFlavor="NA"/>
              <text>Weight Loss Plan<reference value="#ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedActivity_6"/></text>
              <statusCode code="new"/>
              <effectiveTime value="20120330"/>
              <interpretationCode nullFlavor="NA"/>
            </observation>
          </entry>
          <entry>
            <observation classCode="OBS" moodCode="RQO">
              <templateId root="2.16.840.1.113883.10.20.22.4.44"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.72" extension="2285"/>
              <code nullFlavor="NA"/>
              <text>Weight Loss: Goal<reference value="#ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedActivity_7"/></text>
              <statusCode code="new"/>
              <effectiveTime value="20120330"/>
              <interpretationCode nullFlavor="NA"/>
            </observation>
          </entry>
          <entry>
            <procedure classCode="PROC" moodCode="INT" negationInd="false">
              <templateId root="2.16.840.1.113883.10.20.22.4.41"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.72" extension="61405"/>
              <code code="71020" displayName="Chest X-Ray, PA and Lateral Views; Body site: lower respiratory tract structure" codeSystem="CPT" codeSystemName="Current Procedural Terminology"/>
              <text>Chest X-Ray, PA and Lateral Views; Body site: lower respiratory tract structure<reference value="#ref_a518832a9a52407ba376a52c42d33c9b_planOfTreatment__plannedActivity_8"/></text>
              <statusCode code="new"/>
              <effectiveTime value="20130124"/>
              <approachSiteCode nullFlavor="NA"/>
              <targetSiteCode nullFlavor="NA"/>
            </procedure>
          </entry>
        </section>
      </component>
      <component>
        <section classCode="DOCSECT" moodCode="EVN">
          <templateId root="2.16.840.1.113883.10.20.22.2.1.1"/>
          <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.58" extension="6ca9befa14594818"/>
          <code code="10160-0" displayName="History of medication use" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
          <title>Medications</title>
          <text mediaType="text/x-hl7-text+xml">
            <table border="1">
              <thead>
                <tr>
                  <th colspan="5">Active</th>
                </tr>
                <tr>
                  <th>Name</th>
                  <th>Start Date</th>
                  <th>Estimated Completion Date</th>
                  <th>SIG</th>
                  <th>Comments</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td ID="ref_a82c9d0410a24190ba0651b30bfacacc_medication_name_1">Viagra Oral Tablet 50 mg</td>
                  <td ID="ref_a82c9d0410a24190ba0651b30bfacacc_medication_startDate_1">3/13/2013</td>
                  <td ID="ref_a82c9d0410a24190ba0651b30bfacacc_medication_expirationDate_1">4/12/2013</td>
                  <td ID="ref_a82c9d0410a24190ba0651b30bfacacc_medication_sig_1">take 2 tablets (100 mg) by oral route once daily as needed approximately 1 hour before sexual activity for 30 days</td>
                  <td ID="ref_a82c9d0410a24190ba0651b30bfacacc_medication_comments_1"/>
                </tr>
              </tbody>
            </table>
            <table border="1">
              <thead>
                <tr>
                  <th colspan="5">Expired</th>
                </tr>
                <tr>
                  <th>Name</th>
                  <th>Start Date</th>
                  <th>Expiration Date</th>
                  <th>SIG</th>
                  <th>Comments</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td ID="ref_a82c9d0410a24190ba0651b30bfacacc_medication_name_2">azithromycin Oral Tablet 500 mg</td>
                  <td ID="ref_a82c9d0410a24190ba0651b30bfacacc_medication_startDate_2">1/24/2013</td>
                  <td ID="ref_a82c9d0410a24190ba0651b30bfacacc_medication_expirationDate_2">2/23/2013</td>
                  <td ID="ref_a82c9d0410a24190ba0651b30bfacacc_medication_sig_2">take 1 tablet by oral route daily for 30 days then 250 mg tablet once daily for the next 4 days</td>
                  <td ID="ref_a82c9d0410a24190ba0651b30bfacacc_medication_comments_2"/>
                </tr>
                <tr>
                  <td ID="ref_a82c9d0410a24190ba0651b30bfacacc_medication_name_3">albuterol sulfate Inhalation HFA Aerosol Inhaler 90 mcg/actuation</td>
                  <td ID="ref_a82c9d0410a24190ba0651b30bfacacc_medication_startDate_3">1/1/2013</td>
                  <td ID="ref_a82c9d0410a24190ba0651b30bfacacc_medication_expirationDate_3">1/31/2013</td>
                  <td ID="ref_a82c9d0410a24190ba0651b30bfacacc_medication_sig_3">inhale 2 puffs by inhalation route every 6 hours as needed for 30 days</td>
                  <td ID="ref_a82c9d0410a24190ba0651b30bfacacc_medication_comments_3"/>
                </tr>
              </tbody>
            </table>
          </text>
          <entry>
            <substanceAdministration classCode="SBADM" moodCode="INT" negationInd="false">
              <templateId root="2.16.840.1.113883.10.20.22.4.16"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.58" extension="2055"/>
              <text>take 1 tablet by oral route daily for 30 days then 250 mg tablet once daily for the next 4 days<reference value="#ref_a82c9d0410a24190ba0651b30bfacacc_medication_sig_1"/></text>
              <statusCode code="completed"/>
              <effectiveTime xsi:type="IVL_TS">
                <low value="20130124000000"/>
                <high value="20130223000000"/>
              </effectiveTime>
              <routeCode nullFlavor="NA">
                <originalText>
                  <reference value="Oral"/>
                </originalText>
              </routeCode>
              <doseQuantity value="1" unit="tablet"/>
              <consumable typeCode="CSM">
                <manufacturedProduct classCode="MANU">
                  <templateId root="2.16.840.1.113883.10.20.22.4.23"/>
                  <manufacturedMaterial classCode="MMAT">
                    <code code="445655" displayName="azithromycin Oral Tablet 500 mg">
                      <originalText>
                        <reference value="#ref_a82c9d0410a24190ba0651b30bfacacc_medication_name_1"/>
                      </originalText>
                      <translation code="248656" displayName="Azithromycin 500 MG Oral Tablet" codeSystem="2.16.840.1.113883.6.88" codeSystemName="RxNorm"/>
                    </code>
                    <name>azithromycin</name>
                    <lotNumberText nullFlavor="UNK"/>
                  </manufacturedMaterial>
                </manufacturedProduct>
              </consumable>
              <entryRelationship typeCode="REFR" inversionInd="true">
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.1.47"/>
                  <code code="33999-4" displayName="Status" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <statusCode code="completed"/>
                  <value xsi:type="CE" code="421139008" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED" displayName="No Longer Active">
                    <originalText>Expired - </originalText>
                  </value>
                </observation>
              </entryRelationship>
              <entryRelationship typeCode="SUBJ" inversionInd="true">
                <act classCode="ACT" moodCode="INT">
                  <templateId root="2.16.840.1.113883.10.20.1.49"/>
                  <templateId root="1.3.6.1.4.1.19376.1.5.3.1.4.3"/>
                  <code code="PINSTRUCT" codeSystem="1.3.6.1.4.1.19376.1.5.3.2" codeSystemName="IHEActCode"/>
                  <text>
                    <reference value="#ref_a82c9d0410a24190ba0651b30bfacacc_medication_comments_1"/>
                  </text>
                  <statusCode code="completed"/>
                </act>
              </entryRelationship>
            </substanceAdministration>
          </entry>
          <entry>
            <substanceAdministration classCode="SBADM" moodCode="EVN" negationInd="false">
              <templateId root="2.16.840.1.113883.10.20.22.4.16"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.58" extension="2056"/>
              <text>inhale 2 puffs by inhalation route every 6 hours as needed for 30 days<reference value="#ref_a82c9d0410a24190ba0651b30bfacacc_medication_sig_2"/></text>
              <statusCode code="completed"/>
              <effectiveTime xsi:type="IVL_TS">
                <low value="20130101000000"/>
                <high value="20130131000000"/>
              </effectiveTime>
              <routeCode nullFlavor="NA">
                <originalText>
                  <reference value="Inhalation"/>
                </originalText>
              </routeCode>
              <doseQuantity value="2"/>
              <consumable typeCode="CSM">
                <manufacturedProduct classCode="MANU">
                  <templateId root="2.16.840.1.113883.10.20.22.4.23"/>
                  <manufacturedMaterial classCode="MMAT">
                    <code code="279394" displayName="albuterol sulfate Inhalation HFA Aerosol Inhaler 90 mcg/actuation">
                      <originalText>
                        <reference value="#ref_a82c9d0410a24190ba0651b30bfacacc_medication_name_2"/>
                      </originalText>
                      <translation code="745679" displayName="200 ACTUAT Albuterol 0.09 MG/ACTUAT Metered Dose Inhaler" codeSystem="2.16.840.1.113883.6.88" codeSystemName="RxNorm"/>
                    </code>
                    <name>albuterol sulfate</name>
                    <lotNumberText nullFlavor="UNK"/>
                  </manufacturedMaterial>
                </manufacturedProduct>
              </consumable>
              <entryRelationship typeCode="REFR" inversionInd="true">
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.1.47"/>
                  <code code="33999-4" displayName="Status" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <statusCode code="completed"/>
                  <value xsi:type="CE" code="421139008" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED" displayName="No Longer Active">
                    <originalText>Expired - </originalText>
                  </value>
                </observation>
              </entryRelationship>
              <entryRelationship typeCode="SUBJ" inversionInd="true">
                <act classCode="ACT" moodCode="INT">
                  <templateId root="2.16.840.1.113883.10.20.1.49"/>
                  <templateId root="1.3.6.1.4.1.19376.1.5.3.1.4.3"/>
                  <code code="PINSTRUCT" codeSystem="1.3.6.1.4.1.19376.1.5.3.2" codeSystemName="IHEActCode"/>
                  <text>
                    <reference value="#ref_a82c9d0410a24190ba0651b30bfacacc_medication_comments_2"/>
                  </text>
                  <statusCode code="completed"/>
                </act>
              </entryRelationship>
            </substanceAdministration>
          </entry>
          <entry>
            <substanceAdministration classCode="SBADM" moodCode="INT" negationInd="false">
              <templateId root="2.16.840.1.113883.10.20.22.4.16"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.58" extension="2085"/>
              <text>take 2 tablets (100 mg) by oral route once daily as needed approximately 1 hour before sexual activity for 30 days<reference value="#ref_a82c9d0410a24190ba0651b30bfacacc_medication_sig_3"/></text>
              <statusCode code="completed"/>
              <effectiveTime xsi:type="IVL_TS">
                <low value="20130313000000"/>
                <high value="20130412000000"/>
              </effectiveTime>
              <routeCode nullFlavor="NA">
                <originalText>
                  <reference value="Oral"/>
                </originalText>
              </routeCode>
              <doseQuantity value="2" unit="tablet"/>
              <consumable typeCode="CSM">
                <manufacturedProduct classCode="MANU">
                  <templateId root="2.16.840.1.113883.10.20.22.4.23"/>
                  <manufacturedMaterial classCode="MMAT">
                    <code code="186458" displayName="Viagra Oral Tablet 50 mg">
                      <originalText>
                        <reference value="#ref_a82c9d0410a24190ba0651b30bfacacc_medication_name_3"/>
                      </originalText>
                      <translation code="312950" displayName="sildenafil 50 MG Oral Tablet" codeSystem="2.16.840.1.113883.6.88" codeSystemName="RxNorm"/>
                    </code>
                    <name>Viagra</name>
                    <lotNumberText nullFlavor="UNK"/>
                  </manufacturedMaterial>
                </manufacturedProduct>
              </consumable>
              <entryRelationship typeCode="REFR" inversionInd="true">
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.1.47"/>
                  <code code="33999-4" displayName="Status" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <statusCode code="completed"/>
                  <value xsi:type="CE" code="55561003" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED" displayName="Active"/>
                </observation>
              </entryRelationship>
              <entryRelationship typeCode="SUBJ" inversionInd="true">
                <act classCode="ACT" moodCode="INT">
                  <templateId root="2.16.840.1.113883.10.20.1.49"/>
                  <templateId root="1.3.6.1.4.1.19376.1.5.3.1.4.3"/>
                  <code code="PINSTRUCT" codeSystem="1.3.6.1.4.1.19376.1.5.3.2" codeSystemName="IHEActCode"/>
                  <text>
                    <reference value="#ref_a82c9d0410a24190ba0651b30bfacacc_medication_comments_3"/>
                  </text>
                  <statusCode code="completed"/>
                </act>
              </entryRelationship>
            </substanceAdministration>
          </entry>
        </section>
      </component>
      <component>
        <section classCode="DOCSECT" moodCode="EVN">
          <templateId root="2.16.840.1.113883.10.20.22.2.2.1"/>
          <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.60" extension="d309631884994979"/>
          <code code="11369-6" displayName="History of immunizations" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
          <title>History Of Immunizations</title>
          <text mediaType="text/x-hl7-text+xml">
            <table border="1">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Date Admin</th>
                  <th>Mfg Name</th>
                  <th>Mfg Code</th>
                  <th>Trade Name</th>
                  <th>Lot#</th>
                  <th>Route</th>
                  <th>Inj</th>
                  <th>Vis Given</th>
                  <th>Vis Pub</th>
                  <th>CVX</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td ID="ref_574ca34160f54473afeda35f99ad2362_immunization_name_1">Influenza Adult</td>
                  <td ID="ref_574ca34160f54473afeda35f99ad2362_immunization_adminDate_1">3/30/2012</td>
                  <td ID="ref_574ca34160f54473afeda35f99ad2362_immunization_man_1">Abbott Laboratories</td>
                  <td ID="ref_574ca34160f54473afeda35f99ad2362_immunization_manCode_1">AB</td>
                  <td ID="ref_574ca34160f54473afeda35f99ad2362_immunization_trade_1">Fluzone</td>
                  <td ID="ref_574ca34160f54473afeda35f99ad2362_immunization_lot_1">ADV-345</td>
                  <td ID="ref_574ca34160f54473afeda35f99ad2362_immunization_route_1">Intramuscular</td>
                  <td ID="ref_574ca34160f54473afeda35f99ad2362_immunization_injSite_1">Left Deltoid</td>
                  <td ID="ref_574ca34160f54473afeda35f99ad2362_immunization_visGivDate_1">12/27/2012</td>
                  <td ID="ref_574ca34160f54473afeda35f99ad2362_immunization_visPubDate_1">3/3/2010</td>
                  <td ID="ref_574ca34160f54473afeda35f99ad2362_immunization_cvx_1">88</td>
                </tr>
              </tbody>
            </table>
          </text>
          <entry>
            <substanceAdministration classCode="SBADM" moodCode="EVN" negationInd="false">
              <templateId root="2.16.840.1.113883.10.20.22.4.52"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.60" extension="1159"/>
              <code code="IMMUNIZ" codeSystem="2.16.840.1.113883.5.4" codeSystemName="ActCode"/>
              <text>
                <reference value="#ref_574ca34160f54473afeda35f99ad2362_immunization_name_1"/>
              </text>
              <statusCode code="completed"/>
              <effectiveTime value="20120330000000"/>
              <routeCode nullFlavor="NA"/>
              <approachSiteCode nullFlavor="NA"/>
              <doseQuantity value=".5"/>
              <consumable typeCode="CSM">
                <manufacturedProduct classCode="MANU">
                  <templateId root="2.16.840.1.113883.10.20.22.4.54"/>
                  <manufacturedMaterial classCode="MMAT">
                    <code code="88" displayName="influenza, NOS" codeSystem="2.16.840.1.113883.12.292" codeSystemName="CVX">
                      <originalText>
                        <reference value="#ref_574ca34160f54473afeda35f99ad2362_immunization_name_1"/>
                      </originalText>
                    </code>
                    <name nullFlavor="UNK"/>
                    <lotNumberText>ADV-345</lotNumberText>
                  </manufacturedMaterial>
                </manufacturedProduct>
              </consumable>
              <performer>
                <assignedEntity>
                  <id root="2.16.840.1.113883.3.441" extension="41e28a1c762041c198fa797e7392ed92"/>
                  <addr>
                    <streetAddressLine>1234 test</streetAddressLine>
                    <streetAddressLine nullFlavor="UNK"/>
                    <city>Norcross</city>
                    <state>GA</state>
                    <postalCode>30091</postalCode>
                    <country>United States</country>
                  </addr>
                  <telecom value="770-888-3333"/>
                  <assignedPerson>
                    <name>
                      <given>Mike</given>
                      <family>Hardy</family>
                    </name>
                  </assignedPerson>
                  <representedOrganization>
                    <id root="2.16.840.1.113883.3.441" extension="53dab4db681243abb2602853f3487bde"/>
                    <name nullFlavor="UNK"/>
                    <telecom use="WP" value="770-888-3333"/>
                    <addr>
                      <streetAddressLine>1234 test</streetAddressLine>
                      <streetAddressLine nullFlavor="UNK"/>
                      <city>Norcross</city>
                      <state>GA</state>
                      <postalCode>30091</postalCode>
                      <country>United States</country>
                    </addr>
                  </representedOrganization>
                </assignedEntity>
              </performer>
            </substanceAdministration>
          </entry>
        </section>
      </component>
      <component>
        <section classCode="DOCSECT" moodCode="EVN">
          <templateId root="2.16.840.1.113883.10.20.22.2.5.1"/>
          <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.61" extension="b7b0ff1d75364114"/>
          <code code="11450-4" displayName="Problem list" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
          <title>Problem List</title>
          <text mediaType="text/x-hl7-text+xml">
            <table border="1">
              <thead>
                <tr>
                  <th>Description</th>
                  <th>Status</th>
                  <th>Onset</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td ID="ref_d910f32f622b4615970569407d739ca6_problem_name_1">Asthma</td>
                  <td ID="ref_d910f32f622b4615970569407d739ca6_problem_status_1">Active</td>
                  <td ID="ref_d910f32f622b4615970569407d739ca6_problem_onset_1">09/25/2011</td>
                </tr>
                <tr>
                  <td ID="ref_d910f32f622b4615970569407d739ca6_problem_name_2">Essential Hypertension</td>
                  <td ID="ref_d910f32f622b4615970569407d739ca6_problem_status_2">Active</td>
                  <td ID="ref_d910f32f622b4615970569407d739ca6_problem_onset_2">03/30/2012</td>
                </tr>
                <tr>
                  <td ID="ref_d910f32f622b4615970569407d739ca6_problem_name_3">Pharyngitis, Acute</td>
                  <td ID="ref_d910f32f622b4615970569407d739ca6_problem_status_3">Resolved</td>
                  <td ID="ref_d910f32f622b4615970569407d739ca6_problem_onset_3">10/28/2011</td>
                </tr>
                <tr>
                  <td ID="ref_d910f32f622b4615970569407d739ca6_problem_name_4">Pneumonia</td>
                  <td ID="ref_d910f32f622b4615970569407d739ca6_problem_status_4">Active</td>
                  <td ID="ref_d910f32f622b4615970569407d739ca6_problem_onset_4">01/24/2013</td>
                </tr>
                <tr>
                  <td ID="ref_d910f32f622b4615970569407d739ca6_problem_name_5">Acute Bronchitis</td>
                  <td ID="ref_d910f32f622b4615970569407d739ca6_problem_status_5">Active</td>
                  <td ID="ref_d910f32f622b4615970569407d739ca6_problem_onset_5">03/07/2013</td>
                </tr>
                <tr>
                  <td ID="ref_d910f32f622b4615970569407d739ca6_problem_name_6">Malignant melanoma of skin; lower limb, including hip</td>
                  <td ID="ref_d910f32f622b4615970569407d739ca6_problem_status_6">Active</td>
                  <td ID="ref_d910f32f622b4615970569407d739ca6_problem_onset_6">03/07/2013</td>
                </tr>
              </tbody>
            </table>
          </text>
          <entry>
            <act classCode="ACT" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.3"/>
              <id root="2.16.840.1.113883.3.441" extension="85cec11c26ff475fac469cc9fa7a040c"/>
              <code code="CONC" codeSystem="2.16.840.1.113883.5.6"/>
              <statusCode code="active"/>
              <effectiveTime nullFlavor="UNK">
                <low value="20110925000000"/>
                <high nullFlavor="UNK"/>
              </effectiveTime>
              <entryRelationship typeCode="SUBJ" inversionInd="false">
                <observation classCode="OBS" moodCode="EVN" negationInd="false">
                  <templateId root="2.16.840.1.113883.10.20.22.4.4"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.61" extension="1348"/>
                  <code nullFlavor="NA"/>
                  <text>Asthma<reference value="#ref_d910f32f622b4615970569407d739ca6_problem_name_1"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime nullFlavor="UNK">
                    <low value="20110925000000"/>
                    <high nullFlavor="UNK"/>
                  </effectiveTime>
                  <value xsi:type="CD" nullFlavor="UNK">
                    <translation code="195967001" displayName="Asthma" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT">
                      <originalText>
                        <reference value="#ref_d910f32f622b4615970569407d739ca6_problem_name_1"/>
                      </originalText>
                    </translation>
                  </value>
                  <entryRelationship typeCode="REFR" inversionInd="false">
                    <observation classCode="OBS" moodCode="EVN">
                      <templateId root="2.16.840.1.113883.10.20.22.4.6"/>
                      <code code="33999-4" codeSystem="2.16.840.1.113883.6.1" codeSystemName="SNOMED CT"/>
                      <text>Active<reference value="#ref_d910f32f622b4615970569407d739ca6_problem_status_1"/></text>
                      <statusCode code="completed"/>
                      <value xsi:type="CD" code="55561003" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT" displayName="Active"/>
                    </observation>
                  </entryRelationship>
                </observation>
              </entryRelationship>
            </act>
          </entry>
          <entry>
            <act classCode="ACT" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.3"/>
              <id root="2.16.840.1.113883.3.441" extension="a9ffad795c644e8796e7cf62b4cba970"/>
              <code code="CONC" codeSystem="2.16.840.1.113883.5.6"/>
              <statusCode code="active"/>
              <effectiveTime nullFlavor="UNK">
                <low value="20120330000000"/>
                <high nullFlavor="UNK"/>
              </effectiveTime>
              <entryRelationship typeCode="SUBJ" inversionInd="false">
                <observation classCode="OBS" moodCode="EVN" negationInd="false">
                  <templateId root="2.16.840.1.113883.10.20.22.4.4"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.61" extension="1349"/>
                  <code nullFlavor="NA"/>
                  <text>Essential Hypertension<reference value="#ref_d910f32f622b4615970569407d739ca6_problem_name_2"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime nullFlavor="UNK">
                    <low value="20120330000000"/>
                    <high nullFlavor="UNK"/>
                  </effectiveTime>
                  <value xsi:type="CD" nullFlavor="UNK">
                    <translation nullFlavor="NA">
                      <originalText>
                        <reference value="#ref_d910f32f622b4615970569407d739ca6_problem_name_2"/>
                      </originalText>
                    </translation>
                  </value>
                  <entryRelationship typeCode="REFR" inversionInd="false">
                    <observation classCode="OBS" moodCode="EVN">
                      <templateId root="2.16.840.1.113883.10.20.22.4.6"/>
                      <code code="33999-4" codeSystem="2.16.840.1.113883.6.1" codeSystemName="SNOMED CT"/>
                      <text>Active<reference value="#ref_d910f32f622b4615970569407d739ca6_problem_status_2"/></text>
                      <statusCode code="completed"/>
                      <value xsi:type="CD" code="55561003" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT" displayName="Active"/>
                    </observation>
                  </entryRelationship>
                </observation>
              </entryRelationship>
            </act>
          </entry>
          <entry>
            <act classCode="ACT" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.3"/>
              <id root="2.16.840.1.113883.3.441" extension="1a7101d4a2074a649bdc7e9a4f7273f8"/>
              <code code="CONC" codeSystem="2.16.840.1.113883.5.6"/>
              <statusCode code="active"/>
              <effectiveTime nullFlavor="UNK">
                <low value="20111028000000"/>
                <high value="20111108000000"/>
              </effectiveTime>
              <entryRelationship typeCode="SUBJ" inversionInd="false">
                <observation classCode="OBS" moodCode="EVN" negationInd="false">
                  <templateId root="2.16.840.1.113883.10.20.22.4.4"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.61" extension="1350"/>
                  <code nullFlavor="NA"/>
                  <text>Pharyngitis, Acute<reference value="#ref_d910f32f622b4615970569407d739ca6_problem_name_3"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime nullFlavor="UNK">
                    <low value="20111028000000"/>
                    <high value="20111108000000"/>
                  </effectiveTime>
                  <value xsi:type="CD" nullFlavor="UNK">
                    <translation nullFlavor="NA">
                      <originalText>
                        <reference value="#ref_d910f32f622b4615970569407d739ca6_problem_name_3"/>
                      </originalText>
                    </translation>
                  </value>
                  <entryRelationship typeCode="REFR" inversionInd="false">
                    <observation classCode="OBS" moodCode="EVN">
                      <templateId root="2.16.840.1.113883.10.20.22.4.6"/>
                      <code code="33999-4" codeSystem="2.16.840.1.113883.6.1" codeSystemName="SNOMED CT"/>
                      <text>Resolved<reference value="#ref_d910f32f622b4615970569407d739ca6_problem_status_3"/></text>
                      <statusCode code="completed"/>
                      <value xsi:type="CD" code="413322009" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT" displayName="Resolved"/>
                    </observation>
                  </entryRelationship>
                </observation>
              </entryRelationship>
            </act>
          </entry>
          <entry>
            <act classCode="ACT" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.3"/>
              <id root="2.16.840.1.113883.3.441" extension="aa22a3084d3b4cb7ac03e93708cd6318"/>
              <code code="CONC" codeSystem="2.16.840.1.113883.5.6"/>
              <statusCode code="active"/>
              <effectiveTime nullFlavor="UNK">
                <low value="20130124000000"/>
                <high nullFlavor="UNK"/>
              </effectiveTime>
              <entryRelationship typeCode="SUBJ" inversionInd="false">
                <observation classCode="OBS" moodCode="EVN" negationInd="false">
                  <templateId root="2.16.840.1.113883.10.20.22.4.4"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.61" extension="1425"/>
                  <code nullFlavor="NA"/>
                  <text>Pneumonia<reference value="#ref_d910f32f622b4615970569407d739ca6_problem_name_4"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime nullFlavor="UNK">
                    <low value="20130124000000"/>
                    <high nullFlavor="UNK"/>
                  </effectiveTime>
                  <value xsi:type="CD" nullFlavor="UNK">
                    <translation code="233604007" displayName="Pneumonia" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT">
                      <originalText>
                        <reference value="#ref_d910f32f622b4615970569407d739ca6_problem_name_4"/>
                      </originalText>
                    </translation>
                  </value>
                  <entryRelationship typeCode="REFR" inversionInd="false">
                    <observation classCode="OBS" moodCode="EVN">
                      <templateId root="2.16.840.1.113883.10.20.22.4.6"/>
                      <code code="33999-4" codeSystem="2.16.840.1.113883.6.1" codeSystemName="SNOMED CT"/>
                      <text>Active<reference value="#ref_d910f32f622b4615970569407d739ca6_problem_status_4"/></text>
                      <statusCode code="completed"/>
                      <value xsi:type="CD" code="55561003" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT" displayName="Active"/>
                    </observation>
                  </entryRelationship>
                </observation>
              </entryRelationship>
            </act>
          </entry>
          <entry>
            <act classCode="ACT" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.3"/>
              <id root="2.16.840.1.113883.3.441" extension="1439c64973364ded9638d1d06eba0b6f"/>
              <code code="CONC" codeSystem="2.16.840.1.113883.5.6"/>
              <statusCode code="active"/>
              <effectiveTime nullFlavor="UNK">
                <low value="20130307000000"/>
                <high nullFlavor="UNK"/>
              </effectiveTime>
              <entryRelationship typeCode="SUBJ" inversionInd="false">
                <observation classCode="OBS" moodCode="EVN" negationInd="false">
                  <templateId root="2.16.840.1.113883.10.20.22.4.4"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.61" extension="1443"/>
                  <code nullFlavor="NA"/>
                  <text>Acute Bronchitis<reference value="#ref_d910f32f622b4615970569407d739ca6_problem_name_5"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime nullFlavor="UNK">
                    <low value="20130307000000"/>
                    <high nullFlavor="UNK"/>
                  </effectiveTime>
                  <value xsi:type="CD" nullFlavor="UNK">
                    <translation code="10509002" displayName="Acute Bronchitis" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT">
                      <originalText>
                        <reference value="#ref_d910f32f622b4615970569407d739ca6_problem_name_5"/>
                      </originalText>
                    </translation>
                  </value>
                  <entryRelationship typeCode="REFR" inversionInd="false">
                    <observation classCode="OBS" moodCode="EVN">
                      <templateId root="2.16.840.1.113883.10.20.22.4.6"/>
                      <code code="33999-4" codeSystem="2.16.840.1.113883.6.1" codeSystemName="SNOMED CT"/>
                      <text>Active<reference value="#ref_d910f32f622b4615970569407d739ca6_problem_status_5"/></text>
                      <statusCode code="completed"/>
                      <value xsi:type="CD" code="55561003" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT" displayName="Active"/>
                    </observation>
                  </entryRelationship>
                </observation>
              </entryRelationship>
            </act>
          </entry>
          <entry>
            <act classCode="ACT" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.3"/>
              <id root="2.16.840.1.113883.3.441" extension="721ed5c75a4149df826e4ac35212a14e"/>
              <code code="CONC" codeSystem="2.16.840.1.113883.5.6"/>
              <statusCode code="active"/>
              <effectiveTime nullFlavor="UNK">
                <low value="20130307000000"/>
                <high nullFlavor="UNK"/>
              </effectiveTime>
              <entryRelationship typeCode="SUBJ" inversionInd="false">
                <observation classCode="OBS" moodCode="EVN" negationInd="false">
                  <templateId root="2.16.840.1.113883.10.20.22.4.4"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.61" extension="1444"/>
                  <code nullFlavor="NA"/>
                  <text>Malignant melanoma of skin; lower limb, including hip<reference value="#ref_d910f32f622b4615970569407d739ca6_problem_name_6"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime nullFlavor="UNK">
                    <low value="20130307000000"/>
                    <high nullFlavor="UNK"/>
                  </effectiveTime>
                  <value xsi:type="CD" nullFlavor="UNK">
                    <translation code="93641007" displayName="Malignant melanoma of skin; lower limb, including hip" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT">
                      <originalText>
                        <reference value="#ref_d910f32f622b4615970569407d739ca6_problem_name_6"/>
                      </originalText>
                    </translation>
                  </value>
                  <entryRelationship typeCode="REFR" inversionInd="false">
                    <observation classCode="OBS" moodCode="EVN">
                      <templateId root="2.16.840.1.113883.10.20.22.4.6"/>
                      <code code="33999-4" codeSystem="2.16.840.1.113883.6.1" codeSystemName="SNOMED CT"/>
                      <text>Active<reference value="#ref_d910f32f622b4615970569407d739ca6_problem_status_6"/></text>
                      <statusCode code="completed"/>
                      <value xsi:type="CD" code="55561003" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT" displayName="Active"/>
                    </observation>
                  </entryRelationship>
                </observation>
              </entryRelationship>
            </act>
          </entry>
        </section>
      </component>
      <component>
        <section classCode="DOCSECT" moodCode="EVN">
          <templateId root="2.16.840.1.113883.10.20.22.2.4.1"/>
          <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.55" extension="05e1d19b099049e9"/>
          <code code="8716-3" displayName="Vital signs" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
          <title>Vital Signs</title>
          <text mediaType="text/x-hl7-text+xml">
            <table border="1">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Time</th>
                  <th>BP-Sys(mm[Hg]</th>
                  <th>BP-Dia(mm[Hg])</th>
                  <th>HR(bpm)</th>
                  <th>RR(rpm)</th>
                  <th>Temp</th>
                  <th>WT</th>
                  <th>HT</th>
                  <th>BMI</th>
                  <th>BSA</th>
                  <th>BMI Percentile</th>
                  <th>O2 Sat(%)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_date_1">9/25/2011</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_time_1">1:41:00 PM</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bpSystolic_1">120 mmHg</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bpDiastolic_1">75 mmHg</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_hr_1"/>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_rr_1"/>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_temp_1"/>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_wt_1">180 lbs</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_ht_1">70 in</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bmi_1">25.827 kg/m</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bsa_1">2.0081 m</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bmiPercentile_1"/>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_o2_1"/>
                </tr>
                <tr>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_date_2">3/30/2012</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_time_2">2:29:00 PM</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bpSystolic_2">160 mmHg</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bpDiastolic_2">98 mmHg</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_hr_2"/>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_rr_2"/>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_temp_2"/>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_wt_2">195 lbs</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_ht_2">70 in</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bmi_2">27.9793 kg/m</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bsa_2">2.0901 m</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bmiPercentile_2"/>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_o2_2"/>
                </tr>
                <tr>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_date_3">1/24/2013</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_time_3">1:12:00 PM</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bpSystolic_3">120 mmHg</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bpDiastolic_3">80 mmHg</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_hr_3"/>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_rr_3"/>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_temp_3"/>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_wt_3">162 lbs</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_ht_3">70 in</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bmi_3">23.2443 kg/m</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bsa_3">1.905 m</td>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bmiPercentile_3"/>
                  <td ID="ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_o2_3"/>
                </tr>
              </tbody>
            </table>
          </text>
          <entry>
            <organizer classCode="CLUSTER" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.26"/>
              <id root="2.16.840.1.113883.3.441" extension="8532ab7c57204ed99a0783d30d91b9a8"/>
              <code code="46680005" displayName="Vital signs" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT"/>
              <statusCode code="completed"/>
              <effectiveTime value="20110925134100"/>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.27"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.55" extension="2276"/>
                  <code code="8462-4" displayName="BP Diastolic" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>Blood Pressure - Diastolic<reference value="#ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bpDiastolic_1"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20110925134100"/>
                  <value xsi:type="PQ" value="75" unit="mm[Hg]"/>
                  <interpretationCode nullFlavor="NA"/>
                </observation>
              </component>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.27"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.55" extension="2277"/>
                  <code code="8480-6" displayName="BP Systolic" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>Blood Pressure - Systolic<reference value="#ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bpSystolic_1"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20110925134100"/>
                  <value xsi:type="PQ" value="120" unit="mm[Hg]"/>
                  <interpretationCode nullFlavor="NA"/>
                </observation>
              </component>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.27"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.55" extension="2278"/>
                  <code code="41909-3" displayName="Body Mass Index" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>Body Mass Index<reference value="#ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bmi_1"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20110925134100"/>
                  <value xsi:type="PQ" value="25.827" unit="kg/m"/>
                  <interpretationCode nullFlavor="NA"/>
                </observation>
              </component>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.27"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.55" extension="2280"/>
                  <code code="8302-2" displayName="Body Height (Measured)" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>Height<reference value="#ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_ht_1"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20110925134100"/>
                  <value xsi:type="PQ" value="70" unit="[in_us]"/>
                  <interpretationCode nullFlavor="NA"/>
                </observation>
              </component>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.27"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.55" extension="2281"/>
                  <code code="3141-9" displayName="Body Weight (Measured)" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>Weight<reference value="#ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_wt_1"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20110925134100"/>
                  <value xsi:type="PQ" value="180" unit="[lb_av]"/>
                  <interpretationCode nullFlavor="NA"/>
                </observation>
              </component>
            </organizer>
          </entry>
          <entry>
            <organizer classCode="CLUSTER" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.26"/>
              <id root="2.16.840.1.113883.3.441" extension="94dd16c2499141c280db35c508a61501"/>
              <code code="46680005" displayName="Vital signs" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT"/>
              <statusCode code="completed"/>
              <effectiveTime value="20120330142900"/>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.27"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.55" extension="2286"/>
                  <code code="8462-4" displayName="BP Diastolic" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>Blood Pressure - Diastolic<reference value="#ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bpDiastolic_2"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20120330142900"/>
                  <value xsi:type="PQ" value="98" unit="mm[Hg]"/>
                  <interpretationCode nullFlavor="NA"/>
                </observation>
              </component>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.27"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.55" extension="2287"/>
                  <code code="8480-6" displayName="BP Systolic" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>Blood Pressure - Systolic<reference value="#ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bpSystolic_2"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20120330142900"/>
                  <value xsi:type="PQ" value="160" unit="mm[Hg]"/>
                  <interpretationCode nullFlavor="NA"/>
                </observation>
              </component>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.27"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.55" extension="2288"/>
                  <code code="41909-3" displayName="Body Mass Index" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>Body Mass Index<reference value="#ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bmi_2"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20120330142900"/>
                  <value xsi:type="PQ" value="27.9793" unit="kg/m"/>
                  <interpretationCode nullFlavor="NA"/>
                </observation>
              </component>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.27"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.55" extension="2290"/>
                  <code code="8302-2" displayName="Body Height (Measured)" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>Height<reference value="#ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_ht_2"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20120330142900"/>
                  <value xsi:type="PQ" value="70" unit="[in_us]"/>
                  <interpretationCode nullFlavor="NA"/>
                </observation>
              </component>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.27"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.55" extension="2291"/>
                  <code code="3141-9" displayName="Body Weight (Measured)" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>Weight<reference value="#ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_wt_2"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20120330142900"/>
                  <value xsi:type="PQ" value="195" unit="[lb_av]"/>
                  <interpretationCode nullFlavor="NA"/>
                </observation>
              </component>
            </organizer>
          </entry>
          <entry>
            <organizer classCode="CLUSTER" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.26"/>
              <id root="2.16.840.1.113883.3.441" extension="1b635bdaba5c4413812e1e7b617a8a8a"/>
              <code code="46680005" displayName="Vital signs" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT"/>
              <statusCode code="completed"/>
              <effectiveTime value="20130124131200"/>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.27"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.55" extension="2913"/>
                  <code code="8462-4" displayName="BP Diastolic" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>Blood Pressure - Diastolic<reference value="#ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bpDiastolic_3"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20130124131200"/>
                  <value xsi:type="PQ" value="80" unit="mm[Hg]"/>
                  <interpretationCode nullFlavor="NA"/>
                </observation>
              </component>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.27"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.55" extension="2914"/>
                  <code code="8480-6" displayName="BP Systolic" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>Blood Pressure - Systolic<reference value="#ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bpSystolic_3"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20130124131200"/>
                  <value xsi:type="PQ" value="120" unit="mm[Hg]"/>
                  <interpretationCode nullFlavor="NA"/>
                </observation>
              </component>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.27"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.55" extension="2915"/>
                  <code code="41909-3" displayName="Body Mass Index" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>Body Mass Index<reference value="#ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_bmi_3"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20130124131200"/>
                  <value xsi:type="PQ" value="23.2443" unit="kg/m"/>
                  <interpretationCode nullFlavor="NA"/>
                </observation>
              </component>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.27"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.55" extension="2917"/>
                  <code code="8302-2" displayName="Body Height (Measured)" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>Height<reference value="#ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_ht_3"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20130124131200"/>
                  <value xsi:type="PQ" value="70" unit="[in_us]"/>
                  <interpretationCode nullFlavor="NA"/>
                </observation>
              </component>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.27"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.55" extension="2918"/>
                  <code code="3141-9" displayName="Body Weight (Measured)" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>Weight<reference value="#ref_3494ab6b9c3b4bb2a1a72f506b297c8a_vitalSigns_wt_3"/></text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20130124131200"/>
                  <value xsi:type="PQ" value="162" unit="[lb_av]"/>
                  <interpretationCode nullFlavor="NA"/>
                </observation>
              </component>
            </organizer>
          </entry>
        </section>
      </component>
      <component>
        <section classCode="DOCSECT" moodCode="EVN">
          <templateId root="2.16.840.1.113883.10.20.22.2.17"/>
          <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.68" extension="0c01dea83bba4f22"/>
          <code code="29762-2" displayName="Social history" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
          <title>Social History</title>
          <text mediaType="text/x-hl7-text+xml">
            <table border="1">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Status</th>
                  <th>Comments</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td ID="ref_4138a78401f24dcc8fc02b45010222ac_socialHistory_name_1">Tobacco</td>
                  <td ID="ref_4138a78401f24dcc8fc02b45010222ac_socialHistory_status_1">Current</td>
                  <td ID="ref_4138a78401f24dcc8fc02b45010222ac_socialHistory_comment_1"/>
                </tr>
              </tbody>
            </table>
          </text>
          <entry>
            <observation classCode="OBS" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.78"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.68" extension="1265"/>
              <code code="ASSERTION" codeSystem="2.16.840.1.113883.5.4"/>
              <text>Tobacco<reference value="ref_4138a78401f24dcc8fc02b45010222ac_socialHistory_name_1"/></text>
              <statusCode code="completed"/>
              <effectiveTime>
                <low value="19000101000000"/>
              </effectiveTime>
              <value xsi:type="CD" code="77176002" codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT" displayName="Smoker, current status unknown"/>
              <entryRelationship typeCode="REFR">
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.1.56"/>
                  <code code="33999-4" displayName="Status" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <statusCode code="completed"/>
                  <value xsi:type="CD" code="55561003" codeSystem="2.16.840.1.113883.6.96" displayName="active"/>
                </observation>
              </entryRelationship>
            </observation>
          </entry>
        </section>
      </component>
      <component>
        <section classCode="DOCSECT" moodCode="EVN">
          <templateId root="2.16.840.1.113883.10.20.22.2.7.1"/>
          <templateId root="2.16.840.1.113883.10.20.22.2.7"/>
          <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.53" extension="9cd6d66cce11476f"/>
          <code code="47519-4" displayName="History of procedures" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
          <title>History of Procedures</title>
          <text mediaType="text/x-hl7-text+xml">
            <table border="1">
              <thead>
                <tr>
                  <th>Date Ordered</th>
                  <th>Description</th>
                  <th>Order Status</th>
                  <th>Result Status</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td ID="ref_42cb5dd087cf46daac02af56129e82eb_procedure_dateOrdered_1">3/30/2012 12:00 AM</td>
                  <td ID="ref_42cb5dd087cf46daac02af56129e82eb_procedure_name_1">Influenza virus vaccine, split virus, preservative free, when administered to individuals 3 years and older, for intramuscular use</td>
                  <td ID="ref_42cb5dd087cf46daac02af56129e82eb_procedure_orderStatus_1">Reviewed</td>
                  <td ID="ref_42cb5dd087cf46daac02af56129e82eb_procedure_resultStatus_1"/>
                </tr>
                <tr>
                  <td ID="ref_42cb5dd087cf46daac02af56129e82eb_procedure_dateOrdered_2">1/24/2013 12:00 AM</td>
                  <td ID="ref_42cb5dd087cf46daac02af56129e82eb_procedure_name_2">Chest X-Ray, PA and Lateral Views; Body site: lower respiratory tract structure</td>
                  <td ID="ref_42cb5dd087cf46daac02af56129e82eb_procedure_orderStatus_2">Ordered</td>
                  <td ID="ref_42cb5dd087cf46daac02af56129e82eb_procedure_resultStatus_2"/>
                </tr>
              </tbody>
            </table>
          </text>
          <entry>
            <observation classCode="OBS" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.13"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.53" extension="61243"/>
              <code code="90656" displayName="INFLUENZA VIRUS VACC SPLIT PRSRV FREE 3 YRS/&amp;gt; IM" codeSystem="2.16.840.1.113883.6.12" codeSystemName="CPT">
                <originalText>
                  <reference value="#ref_42cb5dd087cf46daac02af56129e82eb_procedure_name_1"/>
                </originalText>
              </code>
              <text>Influenza virus vaccine, split virus, preservative free, when administered to individuals 3 years and older, for intramuscular use<reference value="#ref_42cb5dd087cf46daac02af56129e82eb_procedure_name_1"/></text>
              <statusCode code="completed"/>
              <effectiveTime value="20120330000000"/>
              <value xsi:type="CD" nullFlavor="OTH"/>
            </observation>
          </entry>
          <entry>
            <observation classCode="OBS" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.13"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.53" extension="61405"/>
              <code code="71020" displayName="RADIOLOGIC EXAM CHEST 2 VIEWS FRONTAL&amp;amp;LATERAL" codeSystem="2.16.840.1.113883.6.12" codeSystemName="CPT">
                <originalText>
                  <reference value="#ref_42cb5dd087cf46daac02af56129e82eb_procedure_name_2"/>
                </originalText>
              </code>
              <text>Chest X-Ray, PA and Lateral Views; Body site: lower respiratory tract structure<reference value="#ref_42cb5dd087cf46daac02af56129e82eb_procedure_name_2"/></text>
              <statusCode code="completed"/>
              <effectiveTime value="20130124000000"/>
              <value xsi:type="CD" nullFlavor="OTH"/>
            </observation>
          </entry>
        </section>
      </component>
      <component>
        <section classCode="DOCSECT" moodCode="EVN">
          <templateId root="2.16.840.1.113883.10.20.22.2.3.1"/>
          <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.54" extension="f8f92fedf71d4bf3"/>
          <code code="30954-2" displayName="Relevant diagnostic tests and/or laboratory data" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
          <title>Results Summary</title>
          <text mediaType="text/x-hl7-text+xml">
            <table border="1">
              <thead>
                <tr>
                  <th>Data and Description</th>
                  <th>Results</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td ID="ref_89d999363a94405e9ab266ed947f9ff9_results_testName_1">1/24/2013 1:12 PM</td>
                  <td>
                    <list>
                      <item ID="ref_89d999363a94405e9ab266ed947f9ff9_results_result_1_1">Hgb Bld-mCnc 15.0 g/dL</item>
                      <item ID="ref_89d999363a94405e9ab266ed947f9ff9_results_result_1_2">Hct Fr Bld Auto 50.0 %</item>
                      <item ID="ref_89d999363a94405e9ab266ed947f9ff9_results_result_1_3">WBC # Bld Auto 6.0 x10E3/uL</item>
                      <item ID="ref_89d999363a94405e9ab266ed947f9ff9_results_result_1_4">Platelet # Bld Auto 300.0 x10E3/uL</item>
                    </list>
                  </td>
                </tr>
              </tbody>
            </table>
          </text>
          <entry>
            <organizer classCode="BATTERY" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.1"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.54" extension="2909"/>
              <code nullFlavor="NA"/>
              <statusCode code="completed"/>
              <effectiveTime value="20130124131212"/>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.2"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.54" extension="2909"/>
                  <code code="718-7" displayName="Hgb Bld-mCnc" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>
                    <reference value="#ref_89d999363a94405e9ab266ed947f9ff9_results_result_1_1"/>
                  </text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20130124131212"/>
                  <value xsi:type="PQ" value="15.0" unit="g/dL"/>
                  <interpretationCode nullFlavor="NA"/>
                  <referenceRange>
                    <observationRange>
                      <text>13.5 - 18</text>
                    </observationRange>
                  </referenceRange>
                </observation>
              </component>
            </organizer>
          </entry>
          <entry>
            <organizer classCode="BATTERY" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.1"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.54" extension="2910"/>
              <code nullFlavor="NA"/>
              <statusCode code="completed"/>
              <effectiveTime value="20130124131212"/>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.2"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.54" extension="2910"/>
                  <code code="4544-3" displayName="Hct Fr Bld Auto" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>
                    <reference value="#ref_89d999363a94405e9ab266ed947f9ff9_results_result_1_2"/>
                  </text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20130124131212"/>
                  <value xsi:type="PQ" value="50.0" unit="%"/>
                  <interpretationCode nullFlavor="NA"/>
                  <referenceRange>
                    <observationRange>
                      <text>41 - 53</text>
                    </observationRange>
                  </referenceRange>
                </observation>
              </component>
            </organizer>
          </entry>
          <entry>
            <organizer classCode="BATTERY" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.1"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.54" extension="2911"/>
              <code nullFlavor="NA"/>
              <statusCode code="completed"/>
              <effectiveTime value="20130124131212"/>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.2"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.54" extension="2911"/>
                  <code code="6690-2" displayName="WBC # Bld Auto" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>
                    <reference value="#ref_89d999363a94405e9ab266ed947f9ff9_results_result_1_3"/>
                  </text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20130124131212"/>
                  <value xsi:type="PQ" value="6.0" unit="x10E3/uL"/>
                  <interpretationCode nullFlavor="NA"/>
                  <referenceRange>
                    <observationRange>
                      <text>4.3 - 10.8</text>
                    </observationRange>
                  </referenceRange>
                </observation>
              </component>
            </organizer>
          </entry>
          <entry>
            <organizer classCode="BATTERY" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.1"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.54" extension="2912"/>
              <code nullFlavor="NA"/>
              <statusCode code="completed"/>
              <effectiveTime value="20130124131212"/>
              <component>
                <observation classCode="OBS" moodCode="EVN">
                  <templateId root="2.16.840.1.113883.10.20.22.4.2"/>
                  <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.54" extension="2912"/>
                  <code code="777-3" displayName="Platelet # Bld Auto" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
                  <text>
                    <reference value="#ref_89d999363a94405e9ab266ed947f9ff9_results_result_1_4"/>
                  </text>
                  <statusCode code="completed"/>
                  <effectiveTime value="20130124131212"/>
                  <value xsi:type="PQ" value="300.0" unit="x10E3/uL"/>
                  <interpretationCode nullFlavor="NA"/>
                  <referenceRange>
                    <observationRange>
                      <text>150 - 400</text>
                    </observationRange>
                  </referenceRange>
                </observation>
              </component>
            </organizer>
          </entry>
        </section>
      </component>
      <component>
        <section classCode="DOCSECT" moodCode="EVN">
          <templateId root="2.16.840.1.113883.10.20.22.2.14"/>
          <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.68" extension="9e725ff4a0394627"/>
          <code code="47420-5" displayName="Functional status assessment" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
          <title>Functional Status Assessment</title>
          <text mediaType="text/x-hl7-text+xml">
            <table border="1">
              <thead>
                <tr>
                  <th>Functional Condition</th>
                  <th>Type</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td ID="ref_d8726259e48145e4a31120b62754d448_functionalStatus__funCondition_1">No Impairment</td>
                  <td ID="ref_d8726259e48145e4a31120b62754d448_functionalStatus__funType_1">Cognitive</td>
                </tr>
              </tbody>
            </table>
          </text>
          <entry>
            <observation classCode="OBS" moodCode="EVN">
              <templateId root="2.16.840.1.113883.10.20.22.4.4"/>
              <templateId root="2.16.840.1.113883.10.20.22.4.74"/>
              <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.68" extension="1325"/>
              <code nullFlavor="NA"/>
              <text>No Impairment<reference value="#ref_d8726259e48145e4a31120b62754d448_functionalStatus__funCondition_1"/></text>
              <statusCode code="completed"/>
              <effectiveTime>
                <low nullFlavor="UNK"/>
              </effectiveTime>
              <value xsi:type="CD" nullFlavor="OTH"/>
            </observation>
          </entry>
        </section>
      </component>
      <component>
        <section classCode="DOCSECT" moodCode="EVN">
          <templateId root="1.3.6.1.4.1.19376.1.5.3.1.3.4"/>
          <id root="2.16.840.1.113883.3.441.1.50.300011.51.26604.61" extension="1bb61672a783493c"/>
          <code code="10164-2" displayName="HISTORY OF PRESENT ILLNESS" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"/>
          <title>History of Present Illness</title>
          <text mediaType="text/x-hl7-text+xml">
            <table border="1">
              <thead>
                <tr>
                  <th>Diagnosis</th>
                  <th>Date</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td ID="ref_ee71cb49480544b787c7954ec4523c0e_presentIllness_diagnosis_1">Asthma</td>
                  <td ID="ref_ee71cb49480544b787c7954ec4523c0e_presentIllness_date_1">01/15/2013</td>
                </tr>
                <tr>
                  <td ID="ref_ee71cb49480544b787c7954ec4523c0e_presentIllness_diagnosis_2">Essential Hypertension</td>
                  <td ID="ref_ee71cb49480544b787c7954ec4523c0e_presentIllness_date_2">12/27/2012</td>
                </tr>
                <tr>
                  <td ID="ref_ee71cb49480544b787c7954ec4523c0e_presentIllness_diagnosis_3">Pneumonia</td>
                  <td ID="ref_ee71cb49480544b787c7954ec4523c0e_presentIllness_date_3">01/24/2013</td>
                </tr>
              </tbody>
            </table>
          </text>
        </section>
      </component>
    </structuredBody>
  </component>
</ClinicalDocument>
  </textarea>
  <script>
/**
 * BlueButton.js
 */

// v.0.0.10



// core.js - Essential shared functionality

var Core = function () {
  
  // properties
  var ElementWrapper = function (el) {
    return {
      el: el,
      template: Core.template,
      tag: Core.tag,
      elsByTag: Core.elsByTag,
      attr: Core.attr,
      val: Core.val
    }
  };
  
  // methods
  
  // Cross-browser XML parsing
  var parseXML = function (data) {
    // Must be a string
    if (!data || typeof data !== "string") {
      console.log("BB Error: XML data is not a string");
      return null;
    }
    
    var xml, tmp;
    
    // Standard parser
    if (window.DOMParser) {
      parser = new DOMParser();
      xml = parser.parseFromString(data, "text/xml");
      
    // IE
    } else {
      try {
        xml = new ActiveXObject("Microsoft.XMLDOM");
        xml.async = "false";
        xml.loadXML(data);
      } catch (e) {
        console.log("BB ActiveX Exception: Could not parse XML");
      }
    }
    
    if (!xml || !xml.documentElement || xml.getElementsByTagName("parsererror").length) {
      console.log("BB Error: Could not parse XML");
      return null;
    }
    
    return wrapElement(xml);
  };
  
  var wrapElement = function (el) {
    // el is an array of elements
    if (el.length) {
      var els = [];
      for (var i = 0; i < el.length; i++) {
        els.push(ElementWrapper(el[i]));
      }
      return els;
    
    // el is a single element
    } else {
      return ElementWrapper(el);
    }
  };
  
  var emptyEl = function () {
    var el = document.createElement('empty');
    return wrapElement(el);
  };
  
  var tagAttrVal = function (el, tag, attr, value) {
    el = el.getElementsByTagName(tag);
    for (var i = 0; i < el.length; i++) {
      if (el[i].getAttribute(attr) === value) {
        return el[i];
      }
    }
  };
  
  var template = function (templateId) {
    var el = tagAttrVal(this.el, 'templateId', 'root', templateId);
    if (!el) {
      return emptyEl();
    } else {
      return wrapElement(el.parentNode);
    }
  };
  
  var tag = function (tag) {
    var el = this.el.getElementsByTagName(tag)[0];
    if (!el) {
      return emptyEl();
    } else {
      return wrapElement(el);
    }
  };
  
  var elsByTag = function (tag) {
    return wrapElement(this.el.getElementsByTagName(tag));
  };
  
  var attr = function (attr) {
    if (!this.el) { return null; }
    return this.el.getAttribute(attr);
  };
  
  var val = function () {
    if (!this.el) { return null; }
    try {
      return this.el.childNodes[0].nodeValue;
    } catch (e) {
      return null;
    }
  };
  
  var parseDate = function (str) {
    if (!str || typeof str !== "string") {
      console.log("Error: date is not a string");
      return null;
    }
    var year = str.substr(0, 4);
    var month = str.substr(4, 2);
    var day = str.substr(6, 2);
    return new Date(year, month, day);
  };
  
  return {
    parseXML: parseXML,
    wrapElement: wrapElement,
    template: template,
    tag: tag,
    elsByTag: elsByTag,
    attr: attr,
    val: val,
    parseDate: parseDate
  };
  
}();


// allergies.js

var Allergies = function () {
  
  // dependancies
  var parseDate = Core.parseDate;
  
  // properties
  
  // methods
  var process = function (source, type) {
    var raw, data = [];
    
    switch (type) {
      case 'ccda':
        raw = processCCDA(source);
        break;
      case 'va_c32':
        raw = processVAC32(source);
        break;
      case 'json':
        return processJSON(source);
        break;
    }
    
    for (var i = 0; i < raw.length; i++) {
      data.push({
        date_range: {
          start: raw[i].start_date,
          end: raw[i].end_date
        },
        name: raw[i].name,
        code: raw[i].code,
        code_system: raw[i].code_system,
        code_system_name: raw[i].code_system_name,
        status: raw[i].status,
        severity: raw[i].severity,
        reaction: {
          name: raw[i].reaction_name,
          code: raw[i].reaction_code,
          code_system: raw[i].reaction_code_system
        },
        reaction_type: {
          name: raw[i].reaction_type_name,
          code: raw[i].reaction_type_code,
          code_system: raw[i].reaction_code_system,
          code_system_name: raw[i].reaction_type_code_system_name
        },
        allergen: {
          name: raw[i].allergen_name,
          code: raw[i].allergen_code,
          code_system: raw[i].allergen_code_system,
          code_system_name: raw[i].allergen_code_system_name
        }
      });
    }
    
    return data;
  };
  
  var processCCDA = function (xmlDOM) {
    var data = [], el, entries, entry;
    
    el = xmlDOM.template('2.16.840.1.113883.10.20.22.2.6.1');
    entries = el.elsByTag('entry');
    
    for (var i = 0; i < entries.length; i++) {
      entry = entries[i];
      
      el = entry.tag('effectiveTime');
      var start_date = parseDate(el.tag('low').attr('value')),
          end_date = parseDate(el.tag('high').attr('value'));
      
      el = entry.template('2.16.840.1.113883.10.20.22.4.7').tag('code');
      var name = el.attr('displayName'),
          code = el.attr('code'),
          code_system = el.attr('codeSystem'),
          code_system_name = el.attr('codeSystemName');
      
      // value => reaction_type
      el = entry.template('2.16.840.1.113883.10.20.22.4.7').tag('value');
      var reaction_type_name = el.attr('displayName'),
          reaction_type_code = el.attr('code'),
          reaction_type_code_system = el.attr('codeSystem'),
          reaction_type_code_system_name = el.attr('codeSystemName');
      
      // reaction
      el = entry.template('2.16.840.1.113883.10.20.22.4.9').tag('value');
      var reaction_name = el.attr('displayName'),
          reaction_code = el.attr('code'),
          reaction_code_system = el.attr('codeSystem');
      
      // severity
      el = entry.template('2.16.840.1.113883.10.20.22.4.8').tag('value');
      var severity = el.attr('displayName');
      
      // participant => allergen
      el = entry.tag('participant').tag('code');
      var allergen_name = el.attr('displayName'),
          allergen_code = el.attr('code'),
          allergen_code_system = el.attr('codeSystem'),
          allergen_code_system_name = el.attr('codeSystemName');
      
      // status
      el = entry.template('2.16.840.1.113883.10.20.22.4.28').tag('value');
      var status = el.attr('displayName');
      
      data.push({
        name: name,
        start_date: start_date,
        end_date: end_date,
        code: code,
        code_system: code_system,
        code_system_name: code_system_name,
        reaction_type_name: reaction_type_name,
        reaction_type_code: reaction_type_code,
        reaction_type_code_system: reaction_type_code_system,
        reaction_type_code_system_name: reaction_type_code_system_name,
        reaction_name: reaction_name,
        reaction_code: reaction_code,
        reaction_code_system: reaction_code_system,
        severity: severity,
        allergen_name: allergen_name,
        allergen_code: allergen_code,
        allergen_code_system: allergen_code_system,
        allergen_code_system_name: allergen_code_system_name
      });
    }
    
    return data;
  };
  
  var processVAC32 = function (xmlDOM) {
    var data = [], el, entries, entry;
    
    el = xmlDOM.template('2.16.840.1.113883.3.88.11.83.102');
    entries = el.elsByTag('entry');
    
    for (var i = 0; i < entries.length; i++) {
      entry = entries[i];
      
      el = entry.tag('effectiveTime');
      var start_date = el.tag('low').attr('value'),
          end_date = el.tag('high').attr('value');
      
      el = entry.template('2.16.840.1.113883.10.20.1.28').tag('code');
      var name = el.tag('originalText').val(),
          code = el.attr('code'),
          code_system = el.attr('codeSystem'),
          code_system_name = el.attr('codeSystemName');
      
      // value => reaction_type
      el = entry.template('2.16.840.1.113883.10.20.1.54').tag('value');
      var reaction_type_name = el.attr('displayName'),
          reaction_type_code = el.attr('code'),
          reaction_type_code_system = el.attr('codeSystem'),
          reaction_type_code_system_name = el.attr('codeSystemName');
      
      // reaction
      el = entry.template('2.16.840.1.113883.10.20.1.54').tag('value');
      var reaction_name = el.attr('displayName'),
          reaction_code = el.attr('code'),
          reaction_code_system = el.attr('codeSystem');
      
      // severity
      el = entry.template('2.16.840.1.113883.10.20.1.55').tag('value');
      var severity = el.attr('displayName');
      
      // participant => allergen
      el = entry.tag('participant').tag('code');
      var allergen_name = entry.tag('participant').tag('name').val(),
          allergen_code = el.attr('code'),
          allergen_code_system = el.attr('codeSystem'),
          allergen_code_system_name = el.attr('codeSystemName');
      
      // status
      el = entry.template('2.16.840.1.113883.10.20.22.4.28').tag('value');
      var status = el.attr('displayName');
      
      data.push({
        name: name,
        start_date: start_date,
        end_date: end_date,
        code: code,
        code_system: code_system,
        code_system_name: code_system_name,
        reaction_type_name: reaction_type_name,
        reaction_type_code: reaction_type_code,
        reaction_type_code_system: reaction_type_code_system,
        reaction_type_code_system_name: reaction_type_code_system_name,
        reaction_name: reaction_name,
        reaction_code: reaction_code,
        reaction_code_system: reaction_code_system,
        severity: severity,
        allergen_name: allergen_name,
        allergen_code: allergen_code,
        allergen_code_system: allergen_code_system,
        allergen_code_system_name: allergen_code_system_name
      });
    }
    
    return data;
  };
  
  var processJSON = function (json) {
    return {};
  };
  
  return {
    process: process
  };

}();


// demographics.js

var Demographics = function () {
  
  // dependancies
  var parseDate = Core.parseDate;
  
  // properties
  
  // methods
  var process = function (source, type) {
    var data;
    
    switch (type) {
      case 'ccda':
        data = processCCDA(source);
        break;
      case 'va_c32':
        data = processVAC32(source);
        break;
      case 'json':
        return processJSON(source);
        break;
    }
    
    return {
      name: {
        prefix: data.prefix,
        given: data.given,
        family: data.family
      },
      dob: data.dob,
      gender: data.gender,
      marital_status: data.marital_status,
      address: {
       street: data.street,
        city: data.city,
        state: data.state,
        zip: data.zip,
        country: data.country
      },
      phone: {
        home: data.home,
        work: data.work,
        mobile: data.mobile
      },
      email: data.email,
      language: data.language,
      race: data.race,
      ethnicity: data.ethnicity,
      religion: data.religion,
      birthplace: {
        state: data.birthplace_state,
        zip: data.birthplace_zip,
        country: data.birthplace_country
      },
      guardian: {
        name: {
          given: data.guardian_given,
          family:  data.guardian_family
        },
        relationship: data.guardian_relationship,
        address: {
          street: data.guardian_street,
          city: data.guardian_city,
          state: data.guardian_state,
          zip: data.guardian_zip,
          country: data.guardian_country
        },
        phone: {
          home: data.guardian_home
        }
      },
      provider: {
        organization: data.provider_organization,
        phone: data.provider_phone,
        address: {
          street: data.provider_street,
          city: data.provider_city,
          state: data.provider_state,
          zip: data.provider_zip,
          country: data.provider_country
        }
      }
    };
  };
  
  var processCCDA = function (xmlDOM) {
    var data = {}, el, els, patient;
    
    el = xmlDOM.template('2.16.840.1.113883.10.20.22.1.1');
    patient = el.tag('patientRole');
    el = patient.tag('patient').tag('name');
    data.prefix = el.tag('prefix').val();
    
    els = el.elsByTag('given');
    data.given = [];
    
    for (var i = 0; i < els.length; i++) {
      data.given.push(els[i].val());
    }
    
    data.family = el.tag('family').val();
    
    el = patient.tag('patient');
    data.dob = parseDate(el.tag('birthTime').attr('value'));
    data.gender = el.tag('administrativeGenderCode').attr('displayName');
    data.marital_status = el.tag('maritalStatusCode').attr('displayName');
    
    el = patient.tag('addr');
    els = el.elsByTag('streetAddressLine');
    data.street = [];
    
    for (var i = 0; i < els.length; i++) {
      data.street.push(els[i].val());
    }
    
    data.city = el.tag('city').val();
    data.state = el.tag('state').val();
    data.zip = el.tag('postalCode').val();
    data.country = el.tag('country').val();
    
    el = patient.tag('telecom');
    data.home = el.attr('value');
    data.work = null;
    data.mobile = null;
    
    data.email = null;
    
    data.language = patient.tag('languageCommunication').tag('languageCode').attr('code');
    data.race = patient.tag('raceCode').attr('displayName');
    data.ethnicity = patient.tag('ethnicGroupCode').attr('displayName');
    data.religion = patient.tag('religiousAffiliationCode').attr('displayName');
    
    el = patient.tag('birthplace');
    data.birthplace_state = el.tag('state').val();
    data.birthplace_zip = el.tag('postalCode').val();
    data.birthplace_country = el.tag('country').val();
    
    el = patient.tag('guardian');
    data.guardian_relationship = el.tag('code').attr('displayName');
    data.guardian_home = el.tag('telecom').attr('value');
    el = el.tag('guardianPerson');
    
    els = el.elsByTag('given');
    data.guardian_given = [];
    
    for (var i = 0; i < els.length; i++) {
      data.guardian_given.push(els[i].val());
    }
    
    data.guardian_family = el.tag('family').val();
    
    el = patient.tag('guardian').tag('addr');
    
    els = el.elsByTag('streetAddressLine');
    data.guardian_street = [];
    
    for (var i = 0; i < els.length; i++) {
      data.guardian_street.push(els[i].val());
    }
    
    data.guardian_city = el.tag('city').val();
    data.guardian_state = el.tag('state').val();
    data.guardian_zip = el.tag('postalCode').val();
    data.guardian_country = el.tag('country').val();
    
    el = patient.tag('providerOrganization');
    data.provider_organization = el.tag('name').val();
    data.provider_phone = el.tag('telecom').attr('value');
    
    els = el.elsByTag('streetAddressLine');
    data.provider_street = [];
    
    for (var i = 0; i < els.length; i++) {
      data.provider_street.push(els[i].val());
    }
    
    data.provider_city = el.tag('city').val();
    data.provider_state = el.tag('state').val();
    data.provider_zip = el.tag('postalCode').val();
    data.provider_country = el.tag('country').val();
    
    return data;
  };
  
  var processVAC32 = function (xmlDOM) {
    var data = {}, el, els, patient;
    
    el = xmlDOM.template('1.3.6.1.4.1.19376.1.5.3.1.1.1');
    patient = el.tag('patientRole');
    el = patient.tag('patient').tag('name');
    data.prefix = el.tag('prefix').val();
    
    els = el.elsByTag('given');
    data.given = [];
    
    for (var i = 0; i < els.length; i++) {
      data.given.push(els[i].val());
    }
    
    data.family = el.tag('family').val();
    
    el = patient.tag('patient');
    data.dob = parseDate(el.tag('birthTime').attr('value'));
    data.gender = el.tag('administrativeGenderCode').attr('displayName');
    data.marital_status = el.tag('maritalStatusCode').attr('displayName');
    
    el = patient.tag('addr');
    els = el.elsByTag('streetAddressLine');
    data.street = [];
    
    for (var i = 0; i < els.length; i++) {
      data.street.push(els[i].val());
    }
    
    data.city = el.tag('city').val();
    data.state = el.tag('state').val();
    data.zip = el.tag('postalCode').val();
    data.country = el.tag('country').val();
    
    el = patient.tag('telecom');
    data.home = el.attr('value');
    data.work = null;
    data.mobile = null;
    
    data.email = null;
    
    data.language = patient.tag('languageCommunication').tag('languageCode').attr('code');
    data.race = patient.tag('raceCode').attr('displayName');
    data.ethnicity = patient.tag('ethnicGroupCode').attr('displayName');
    data.religion = patient.tag('religiousAffiliationCode').attr('displayName');
    
    el = patient.tag('birthplace');
    data.birthplace_state = el.tag('state').val();
    data.birthplace_zip = el.tag('postalCode').val();
    data.birthplace_country = el.tag('country').val();
    
    el = patient.tag('guardian');
    data.guardian_relationship = el.tag('code').attr('displayName');
    data.guardian_home = el.tag('telecom').attr('value');
    el = el.tag('guardianPerson');
    
    els = el.elsByTag('given');
    data.guardian_given = [];
    
    for (var i = 0; i < els.length; i++) {
      data.guardian_given.push(els[i].val());
    }
    
    data.guardian_family = el.tag('family').val();
    
    el = patient.tag('guardian').tag('addr');
    
    els = el.elsByTag('streetAddressLine');
    data.guardian_street = [];
    
    for (var i = 0; i < els.length; i++) {
      data.guardian_street.push(els[i].val());
    }
    
    data.guardian_city = el.tag('city').val();
    data.guardian_state = el.tag('state').val();
    data.guardian_zip = el.tag('postalCode').val();
    data.guardian_country = el.tag('country').val();
    
    el = patient.tag('providerOrganization');
    data.provider_organization = el.tag('name').val();
    data.provider_phone = el.tag('telecom').attr('value');
    
    els = el.elsByTag('streetAddressLine');
    data.provider_street = [];
    
    for (var i = 0; i < els.length; i++) {
      data.provider_street.push(els[i].val());
    }
    
    data.provider_city = el.tag('city').val();
    data.provider_state = el.tag('state').val();
    data.provider_zip = el.tag('postalCode').val();
    data.provider_country = el.tag('country').val();
    
    return data;
  };
  
  var processJSON = function (json) {
    return {};
  };
  
  return {
    process: process
  };

}();


// encounters.js

var Encounters = function () {
  
  // dependancies
  var parseDate = Core.parseDate;
  
  // properties
  
  // methods
  var process = function (source, type) {
    var raw, data = [];
    
    switch (type) {
      case 'ccda':
        raw = processCCDA(source);
        break;
      case 'va_c32':
        raw = processVAC32(source);
        break;
      case 'json':
        return processJSON(source);
        break;
    }
    
    for (var i = 0; i < raw.length; i++) {
      data.push({
        date: raw[i].date,
        name: raw[i].name,
        code: raw[i].code,
        code_system: raw[i].code_system,
        code_system_name: raw[i].code_system_name,
        code_system_version: raw[i].code_system_version,
        finding: {
          name: raw[i].finding_name,
          code: raw[i].finding_code,
          code_system: raw[i].finding_code_system
        },
        translation: {
          name: raw[i].translation_name,
          code: raw[i].translation_code,
          code_system: raw[i].translation_code_system,
          code_system_name: raw[i].translation_code_system_name
        },
        performer: {
          name: raw[i].performer_name,
          code: raw[i].performer_code,
          code_system: raw[i].performer_code_system,
          code_system_name: raw[i].performer_code_system_name
        },
        location: {
          organization: raw[i].organization,
          street: raw[i].street,
          city: raw[i].city,
          state: raw[i].state,
          zip: raw[i].zip,
          country: raw[i].country
        }
      });
    }
    return data;
  };
  
  var processCCDA = function (xmlDOM) {
    var data = [], el, els, entries, entry;
    
    el = xmlDOM.template('2.16.840.1.113883.10.20.22.2.22');
    entries = el.elsByTag('entry');
    
    for (var i = 0; i < entries.length; i++) {
      entry = entries[i];
      
      var date = parseDate(entry.tag('effectiveTime').attr('value'));
      
      el = entry.tag('code');
      var name = el.attr('displayName'),
          code = el.attr('code'),
          code_system = el.attr('codeSystem'),
          code_system_name = el.attr('codeSystemName'),
          code_system_version = el.attr('codeSystemVersion');
      
      // finding
      el = entry.tag('value');
      var finding_name = el.attr('displayName'),
          finding_code = el.attr('code'),
          finding_code_system = el.attr('codeSystem');
      
      // translation
      el = entry.tag('translation');
      var translation_name = el.attr('displayName'),
          translation_code = el.attr('code'),
          translation_code_system = el.attr('codeSystem'),
          translation_code_system_name = el.attr('codeSystemName');
      
      // performer
      el = entry.tag('performer').tag('code');
      var performer_name = el.attr('displayName'),
          performer_code = el.attr('code'),
          performer_code_system = el.attr('codeSystem'),
          performer_code_system_name = el.attr('codeSystemName');

      // participant => location
      el = entry.tag('participant');
      var organization = el.tag('code').attr('displayName');
      
      els = el.elsByTag('streetAddressLine');
      street = [];
      
      for (var j = 0; j < els.length; j++) {
        street.push(els[j].val());
      }
      
      var city = el.tag('city').val(),
          state = el.tag('state').val(),
          zip = el.tag('postalCode').val(),
          country = el.tag('country').val();
      
      data.push({
        date: date,
        name: name,
        code: code,
        code_system: code_system,
        code_system_name: code_system_name,
        code_system_version: code_system_version,
        finding_name: finding_name,
        finding_code: finding_code,
        finding_code_system: finding_code_system,
        translation_name: translation_name,
        translation_code: translation_code,
        translation_code_system: translation_code_system,
        translation_code_system_name: translation_code_system_name,
        performer_name: performer_name,
        performer_code_system: performer_code_system,
        performer_code_system_name: performer_code_system_name,
        organization: organization,
        street: street,
        city: city,
        state: state,
        zip: zip,
        country: country
      });
    }
    
    return data;
  };
  
 var processVAC32 = function (xmlDOM) {
   var data = [], el, els, entries, entry;
    
    el = xmlDOM.template('2.16.840.1.113883.10.20.1.3');
    entries = el.elsByTag('entry');
    
    for (var i = 0; i < entries.length; i++) {
      entry = entries[i];
      
      var date = parseDate(entry.tag('effectiveTime').tag('low').attr('value'));
      
      el = entry.tag('code');
      var name = el.attr('displayName'),
          code = el.attr('code'),
          code_system = el.attr('codeSystem'),
          code_system_name = el.attr('codeSystemName'),
          code_system_version = el.attr('codeSystemVersion');
      
      // finding
      el = entry.tag('value');
      var finding_name = el.attr('displayName'),
          finding_code = el.attr('code'),
          finding_code_system = el.attr('codeSystem');
      
      // translation
      el = entry.tag('translation');
      var translation_name = el.attr('displayName'),
          translation_code = el.attr('code'),
          translation_code_system = el.attr('codeSystem'),
          translation_code_system_name = el.attr('codeSystemName');
      
      // performer
      el = entry.tag('performer').tag('code');
      var performer_name = el.attr('displayName'),
          performer_code = el.attr('code'),
          performer_code_system = el.attr('codeSystem'),
          performer_code_system_name = el.attr('codeSystemName');

      // participant => location
      el = entry.tag('participant');
      var organization = el.tag('code').attr('displayName');
      
      els = el.elsByTag('streetAddressLine');
      street = [];
      
      for (var j = 0; j < els.length; j++) {
        street.push(els[j].val());
      }
      
      var city = el.tag('city').val(),
          state = el.tag('state').val(),
          zip = el.tag('postalCode').val(),
          country = el.tag('country').val();
      
      data.push({
        date: date,
        name: name,
        code: code,
        code_system: code_system,
        code_system_name: code_system_name,
        code_system_version: code_system_version,
        finding_name: finding_name,
        finding_code: finding_code,
        finding_code_system: finding_code_system,
        translation_name: translation_name,
        translation_code: translation_code,
        translation_code_system: translation_code_system,
        translation_code_system_name: translation_code_system_name,
        performer_name: performer_name,
        performer_code_system: performer_code_system,
        performer_code_system_name: performer_code_system_name,
        organization: organization,
        street: street,
        city: city,
        state: state,
        zip: zip,
        country: country
      });
    }
    
    return data;
  };
  
  var processJSON = function (json) {
    return {};
  };
  
  return {
    process: process
  };

}();


// immunizations.js

var Immunizations = function () {
  
  // dependancies
  var parseDate = Core.parseDate;
  
  // properties
  
  // methods
  var process = function (source, type) {
    var raw, data = [];
    
    switch (type) {
      case 'ccda':
        raw = processCCDA(source);
        break;
      case 'va_c32':
        raw = processVAC32(source);
        break;
      case 'json':
        return processJSON(source);
        break;
    }
    
    for (var i = 0; i < raw.length; i++) {
      data.push({
        date: raw[i].date,
        product: {
          name: raw[i].product_name,
          code: raw[i].product_code,
          code_system: raw[i].product_code_system,
          code_system_name: raw[i].product_code_system_name,
          translation: {
            name: raw[i].translation_name,
            code: raw[i].translation_code,
            code_system: raw[i].translation_code_system,
            code_system_name: raw[i].translation_code_system_name
          }
        },
        route: {
          name: raw[i].route_name,
          code: raw[i].route_code,
          code_system: raw[i].route_code_system,
          code_system_name: raw[i].route_code_system_name
        },
        instructions: raw[i].instructions_text,
        education_type: {
          name: raw[i].education_name,
          code: raw[i].education_code,
          code_system: raw[i].education_code_system
        }
      });
    }
    
    return data;
  };
  
  var processCCDA = function (xmlDOM) {
    var data = [], el, entries, entry;
    
    el = xmlDOM.template('2.16.840.1.113883.10.20.22.2.2.1');
    entries = el.elsByTag('entry');
    
    for (var i = 0; i < entries.length; i++) {
      entry = entries[i];
      
      // date
      el = entry.tag('effectiveTime');
      var date = parseDate(el.attr('value'));
      
      // product
      el = entry.template('2.16.840.1.113883.10.20.22.4.54').tag('code');
      var product_name = el.attr('displayName'),
          product_code = el.attr('code'),
          product_code_system = el.attr('codeSystem'),
          product_code_system_name = el.attr('codeSystemName');
      
      // translation
      el = entry.template('2.16.840.1.113883.10.20.22.4.54').tag('translation');
      var translation_name = el.attr('displayName'),
          translation_code = el.attr('code'),
          translation_code_system = el.attr('codeSystem'),
          translation_code_system_name = el.attr('codeSystemName');
      
      // route
      el = entry.tag('routeCode');
      var route_name = el.attr('displayName'),
          route_code = el.attr('code'),
          route_code_system = el.attr('codeSystem'),
          route_code_system_name = el.attr('codeSystemName');
      
      // instructions
      el = entry.template('2.16.840.1.113883.10.20.22.4.20');
      var instructions_text = el.tag('text').val();
      el = el.tag('code');
      var education_name = el.attr('displayName'),
          education_code = el.attr('code'),
          education_code_system = el.attr('codeSystem');
      
      data.push({
        date: date,
        product_name: product_name,
        product_code: product_code,
        product_code_system: product_code_system,
        product_code_system_name: product_code_system_name,
        translation_name: translation_name,
        translation_code: translation_code,
        translation_code_system: translation_code_system,
        translation_code_system_name: translation_code_system_name,
        route_name: route_name,
        route_code: route_code,
        route_code_system: route_code_system,
        route_code_system_name: route_code_system_name,
        instructions_text: instructions_text,
        education_name: education_name,
        education_code: education_code,
        education_code_system: education_code_system
      });
    }
    return data;
  };
  
  var processVAC32 = function (xmlDOM) {
    var data = [], el, entries, entry;
    
    el = xmlDOM.template('2.16.840.1.113883.10.20.1.6');
    entries = el.elsByTag('entry');
    
    for (var i = 0; i < entries.length; i++) {
      entry = entries[i];
      
      // date
      el = entry.tag('effectiveTime');
      var date = parseDate(el.attr('value'));
      
      // product
      el = entry.template('2.16.840.1.113883.10.20.1.53').tag('code');
      var product_name = el.attr('displayName'),
          product_code = el.attr('code'),
          product_code_system = el.attr('codeSystem'),
          product_code_system_name = el.attr('codeSystemName');
      
      // translation
      el = entry.template('2.16.840.1.113883.10.20.22.4.54').tag('translation');
      var translation_name = el.attr('displayName'),
          translation_code = el.attr('code'),
          translation_code_system = el.attr('codeSystem'),
          translation_code_system_name = el.attr('codeSystemName');
      
      // route
      el = entry.tag('routeCode');
      var route_name = el.attr('displayName'),
          route_code = el.attr('code'),
          route_code_system = el.attr('codeSystem'),
          route_code_system_name = el.attr('codeSystemName');
      
      // instructions
      el = entry.template('2.16.840.1.113883.10.20.22.4.20');
      var instructions_text = el.tag('text').val();
      el = el.tag('code');
      var education_name = el.attr('displayName'),
          education_code = el.attr('code'),
          education_code_system = el.attr('codeSystem');
      
      data.push({
        date: date,
        product_name: product_name,
        product_code: product_code,
        product_code_system: product_code_system,
        product_code_system_name: product_code_system_name,
        translation_name: translation_name,
        translation_code: translation_code,
        translation_code_system: translation_code_system,
        translation_code_system_name: translation_code_system_name,
        route_name: route_name,
        route_code: route_code,
        route_code_system: route_code_system,
        route_code_system_name: route_code_system_name,
        instructions_text: instructions_text,
        education_name: education_name,
        education_code: education_code,
        education_code_system: education_code_system
      });
    }
    return data;
  };
  
  var processJSON = function (json) {
    return {};
  };
  
  return {
    process: process
  };

}();


// labs.js

var Labs = function () {
  
  // dependancies
  var parseDate = Core.parseDate;
  
  // properties
  
  // methods
  var process = function (source, type) {
    var panels, data = [];
    
    switch (type) {
      case 'ccda':
        panels = processCCDA(source);
        break;
      case 'va_c32':
        panels = processVAC32(source);
        break;
      case 'json':
        return processJSON(source);
        break;
    }
    
    for (var i = 0; i < panels.length; i++) {
      var p = panels[i];
      var panel = {
        name: p.name,
        code: p.code,
        code_system: p.code_system,
        code_system_name: p.code_system_name
      }
      
      var results = [];
      
      for (var j = 0; j < p.results.length; j++) {
        var r = p.results[j];
        results.push({
          date: r.date,
          name: r.name,
          value: r.value,
          unit: r.unit,
          code: r.code,
          code_system: r.code_system,
          code_system_name: r.code_system_name,
          reference: {
            low: r.reference_low,
            high: r.reference_high
          }
        });
      }
      
      panel.results = results;
      data.push(panel);
    }
    
    return data;
  };
  
  var processCCDA = function (xmlDOM) {
    var data = [], results_data = [], el, entries, entry, results, result;
    
    el = xmlDOM.template('2.16.840.1.113883.10.20.22.2.3.1');
    entries = el.elsByTag('entry');
    
    for (var i = 0; i < entries.length; i++) {
      entry = entries[i];
      
      // panel
      el = entry.tag('code');
      var panel_name = el.attr('displayName'),
          panel_code = el.attr('code'),
          panel_code_system = el.attr('codeSystem'),
          panel_code_system_name = el.attr('codeSystemName');
      
      results = entry.elsByTag('component');
      
      for (var j = 0; j < results.length; j++) {
        result = results[j];
        
        var date = parseDate(result.tag('effectiveTime').attr('value'));
        
        el = result.tag('code');
        var name = el.attr('displayName'),
            code = el.attr('code'),
            code_system = el.attr('codeSystem'),
            code_system_name = el.attr('codeSystemName');
        
        el = result.tag('value');
        var value = parseInt(el.attr('value')),
            unit = el.attr('unit');
        
        // reference range may not be present
        reference_low = null;
        reference_high = null;
        
        results_data.push({
          date: date,
          name: name,
          value: value,
          unit: unit,
          code: code,
          code_system: code_system,
          code_system_name: code_system_name,
          reference_low: reference_low,
          reference_high: reference_high
        });
      }
      
      data.push({
        name: panel_name,
        code: panel_code,
        code_system: panel_code_system,
        code_system_name: panel_code_system_name,
        results: results_data
      });
    }
    return data;
  };
  
  var processVAC32 = function (xmlDOM) {
    var data = [], results_data = [], el, entries, entry, results, result;
    
    el = xmlDOM.template('2.16.840.1.113883.10.20.1.14');
    entries = el.elsByTag('entry');
    
    for (var i = 0; i < entries.length; i++) {
      entry = entries[i];
      
      // panel
      el = entry.tag('code');
      var panel_name = el.attr('displayName'),
          panel_code = el.attr('code'),
          panel_code_system = el.attr('codeSystem'),
          panel_code_system_name = el.attr('codeSystemName');
      
      results = entry.elsByTag('component');
      
      for (var j = 0; j < results.length; j++) {
        result = results[j];
        
        var date = parseDate(result.tag('effectiveTime').attr('value'));
        
        el = result.tag('code');
        var name = el.tag('originalText').val(),
            code = el.attr('code'),
            code_system = el.attr('codeSystem'),
            code_system_name = el.attr('codeSystemName');
        
        el = result.tag('value');
        var value = parseInt(el.attr('value')),
            unit = el.attr('unit');
        
        // reference range may not be present
        reference_low = null;
        reference_high = null;
        
        results_data.push({
          date: date,
          name: name,
          value: value,
          unit: unit,
          code: code,
          code_system: code_system,
          code_system_name: code_system_name,
          reference_low: reference_low,
          reference_high: reference_high
        });
      }
      
      data.push({
        name: panel_name,
        code: panel_code,
        code_system: panel_code_system,
        code_system_name: panel_code_system_name,
        results: results_data
      });
    }
    return data;
  };
  
  var processJSON = function (json) {
    return {};
  };
  
  return {
    process: process
  };

}();


// medications.js

var Medications = function () {
  
  // dependancies
  var parseDate = Core.parseDate;
  
  // properties
  
  // methods
    var process = function (source, type) {
    var raw, data = [];
    
    switch (type) {
      case 'ccda':
        raw = processCCDA(source);
        break;
      case 'va_c32':
        raw = processVAC32(source);
        break;
      case 'json':
        return processJSON(source);
        break;
    }
    
    for (var i = 0; i < raw.length; i++) {
      data.push({
        date_range: {
          start: raw[i].start_date,
          end: raw[i].end_date
        },
        product: {
          name: raw[i].product_name,
          code: raw[i].product_code,
          code_system: raw[i].product_code_system,
          translation: {
            name: raw[i].translation_name,
            code: raw[i].translation_code,
            code_system: raw[i].translation_code_system,
            code_system_name: raw[i].translation_code_system_name
          }
        },
        dose_quantity: {
          value: raw[i].dose_value,
          unit: raw[i].dose_unit
        },
        rate_quantity: {
          value: raw[i].rate_quantity_value,
          unit: raw[i].rate_quantity_unit
        },
        precondition: {
          name: raw[i].precondition_name,
          code: raw[i].precondition_code,
          code_system: raw[i].precondition_code_system
        },
        reason: {
          name: raw[i].reason_name,
          code: raw[i].reason_code,
          code_system: raw[i].reason_code_system
        },
        route: {
          name: raw[i].route_name,
          code: raw[i].route_code,
          code_system: raw[i].route_code_system,
          code_system_name: raw[i].route_code_system_name
        },
        vehicle: {
          name: raw[i].vehicle_name,
          code: raw[i].vehicle_code,
          code_system: raw[i].vehicle_code_system,
          code_system_name: raw[i].vehicle_code_system_name
        },
        administration: {
          name: raw[i].administration_name,
          code: raw[i].administration_code,
          code_system: raw[i].administration_code_system,
          code_system_name: raw[i].administration_code_system_name
        },
        prescriber: {
          organization: raw[i].prescriber_organization,
          person: raw[i].prescriber_person
        }
      });
    }
    
    return data;
  };
  
  var processCCDA = function (xmlDOM) {
    var data = [], el, entries, entry;
    
    el = xmlDOM.template('2.16.840.1.113883.10.20.22.2.1.1');
    entries = el.elsByTag('entry');
    
    for (var i = 0; i < entries.length; i++) {
      entry = entries[i];
      
      el = entry.tag('effectiveTime');
      var start_date = parseDate(el.tag('low').attr('value')),
          end_date = parseDate(el.tag('high').attr('value'));
      
      el = entry.tag('manufacturedProduct').tag('code');
      var product_name = el.attr('displayName'),
          product_code = el.attr('code'),
          product_code_system = el.attr('codeSystem');
      
      el = entry.tag('manufacturedProduct').tag('translation');
      var translation_name = el.attr('displayName'),
          translation_code = el.attr('code'),
          translation_code_system = el.attr('codeSystem'),
          translation_code_system_name = el.attr('codeSystemName');
      
      el = entry.tag('doseQuantity');
      var dose_value = el.attr('value'),
          dose_unit = el.attr('unit');
      
      el = entry.tag('rateQuantity');
      var rate_quantity_value = el.attr('value'),
          rate_quantity_unit = el.attr('unit');
      
      el = entry.tag('precondition').tag('value');
      var precondition_name = el.attr('displayName'),
          precondition_code = el.attr('code'),
          precondition_code_system = el.attr('codeSystem'),
      
      el = entry.template('2.16.840.1.113883.10.20.22.4.19').tag('value');
      var reason_name = el.attr('displayName'),
          reason_code = el.attr('code'),
          reason_code_system = el.attr('codeSystem');
      
      el = entry.tag('routeCode')
      var route_name = el.attr('displayName'),
          route_code = el.attr('code'),
          route_code_system = el.attr('codeSystem'),
          route_code_system_name = el.attr('codeSystemName');
      
      // participant => vehicle
      el = entry.tag('participant').tag('code');
      var vehicle_name = el.attr('displayName'),
          vehicle_code = el.attr('code'),
          vehicle_code_system = el.attr('codeSystem'),
          vehicle_code_system_name = el.attr('codeSystemName');
      
      el = entry.tag('administrationUnitCode');
      var administration_name = el.attr('displayName'),
          administration_code = el.attr('code'),
          administration_code_system = el.attr('codeSystem'),
          administration_code_system_name = el.attr('codeSystemName');
      
      // performer => prescriber
      el = entry.tag('performer');
      var prescriber_organization = el.tag('name').val(),
          prescriber_person = null;
      
      data.push({
        start_date: start_date,
        end_date: end_date,
        product_name: product_name,
        product_code: product_code,
        product_code_system: product_code_system,
        translation_name: translation_name,
        translation_code: translation_code,
        translation_code_system: translation_code_system,
        translation_code_system_name: translation_code_system_name,
        dose_value: dose_value,
        dose_unit: dose_unit,
        rate_quantity_value: rate_quantity_value,
        rate_quantity_unit: rate_quantity_unit,
        precondition_name: precondition_name,
        precondition_code: precondition_code,
        precondition_code_system: precondition_code_system,
        reason_name: reason_name,
        reason_code: reason_code,
        reason_code_system: reason_code_system,
        route_name: route_name,
        route_code: route_code,
        route_code_system: route_code_system,
        route_code_system_name: route_code_system_name,
        vehicle_name: vehicle_name,
        vehicle_code: vehicle_code,
        vehicle_code_system: vehicle_code_system,
        vehicle_code_system_name: vehicle_code_system_name,
        administration_name: administration_name,
        administration_code: administration_code,
        administration_code_system: administration_code_system,
        administration_code_system_name: administration_code_system_name,
        prescriber_organization: prescriber_organization,
        prescriber_person: prescriber_person
      });
    }
    
    return data;
  };
  
  var processVAC32 = function (xmlDOM) {
    var data = [], el, entries, entry;
    
    el = xmlDOM.template('2.16.840.1.113883.3.88.11.83.112');
    entries = el.elsByTag('entry');
    
    for (var i = 0; i < entries.length; i++) {
      entry = entries[i];
      
      el = entry.tag('effectiveTime');
      var start_date = parseDate(el.tag('low').attr('value')),
          end_date = parseDate(el.tag('high').attr('value'));
      
      el = entry.tag('manufacturedProduct').tag('code');
      var product_name = el.attr('displayName'),
          product_code = el.attr('code'),
          product_code_system = el.attr('codeSystem');
      
      el = entry.tag('manufacturedProduct').tag('translation');
      var translation_name = el.attr('displayName'),
          translation_code = el.attr('code'),
          translation_code_system = el.attr('codeSystem'),
          translation_code_system_name = el.attr('codeSystemName');
      
      el = entry.tag('doseQuantity');
      var dose_value = el.attr('value'),
          dose_unit = el.attr('unit');
      
      el = entry.tag('rateQuantity');
      var rate_quantity_value = el.attr('value'),
          rate_quantity_unit = el.attr('unit');
      
      el = entry.tag('precondition').tag('value');
      var precondition_name = el.attr('displayName'),
          precondition_code = el.attr('code'),
          precondition_code_system = el.attr('codeSystem'),
      
      el = entry.template('2.16.840.1.113883.10.20.22.4.19').tag('value');
      var reason_name = el.attr('displayName'),
          reason_code = el.attr('code'),
          reason_code_system = el.attr('codeSystem');
      
      el = entry.tag('routeCode')
      var route_name = el.attr('displayName'),
          route_code = el.attr('code'),
          route_code_system = el.attr('codeSystem'),
          route_code_system_name = el.attr('codeSystemName');
      
      // participant => vehicle
      el = entry.tag('participant').tag('code');
      var vehicle_name = el.attr('displayName'),
          vehicle_code = el.attr('code'),
          vehicle_code_system = el.attr('codeSystem'),
          vehicle_code_system_name = el.attr('codeSystemName');
      
      el = entry.tag('administrationUnitCode');
      var administration_name = el.attr('displayName'),
          administration_code = el.attr('code'),
          administration_code_system = el.attr('codeSystem'),
          administration_code_system_name = el.attr('codeSystemName');
      
      // performer => prescriber
      el = entry.tag('performer');
      var prescriber_organization = el.tag('name').val(),
          prescriber_person = null;
      
      data.push({
        start_date: start_date,
        end_date: end_date,
        product_name: product_name,
        product_code: product_code,
        product_code_system: product_code_system,
        translation_name: translation_name,
        translation_code: translation_code,
        translation_code_system: translation_code_system,
        translation_code_system_name: translation_code_system_name,
        dose_value: dose_value,
        dose_unit: dose_unit,
        rate_quantity_value: rate_quantity_value,
        rate_quantity_unit: rate_quantity_unit,
        precondition_name: precondition_name,
        precondition_code: precondition_code,
        precondition_code_system: precondition_code_system,
        reason_name: reason_name,
        reason_code: reason_code,
        reason_code_system: reason_code_system,
        route_name: route_name,
        route_code: route_code,
        route_code_system: route_code_system,
        route_code_system_name: route_code_system_name,
        vehicle_name: vehicle_name,
        vehicle_code: vehicle_code,
        vehicle_code_system: vehicle_code_system,
        vehicle_code_system_name: vehicle_code_system_name,
        administration_name: administration_name,
        administration_code: administration_code,
        administration_code_system: administration_code_system,
        administration_code_system_name: administration_code_system_name,
        prescriber_organization: prescriber_organization,
        prescriber_person: prescriber_person
      });
    }
    
    return data;
  };
  
  var processJSON = function (json) {
    return {};
  };
  
  return {
    process: process
  };

}();


// problems.js

var Problems = function () {
  
  // dependancies
  var parseDate = Core.parseDate;
  
  // properties
  
  // methods
  var process = function (source, type) {
    var raw, data = [];
    
    switch (type) {
      case 'ccda':
        raw = processCCDA(source);
        break;
      case 'va_c32':
        raw = processVAC32(source);
        break;
      case 'json':
        return processJSON(source);
        break;
    }
    
    for (var i = 0; i < raw.length; i++) {
      data.push({
        date_range: {
          start: raw[i].start_date,
          end: raw[i].end_date
        },
        name: raw[i].name,
        status: raw[i].status,
        age: raw[i].age,
        code: raw[i].code,
        code_system: raw[i].code_system
      });
    }
    
    return data;
  };
  
  var processCCDA = function (xmlDOM) {
    var data = [], el, entries, entry;
    
    el = xmlDOM.template('2.16.840.1.113883.10.20.22.2.5.1');
    entries = el.elsByTag('entry');
    
    for (var i = 0; i < entries.length; i++) {
      entry = entries[i];
      
      el = entry.tag('effectiveTime');
      var start_date = parseDate(el.tag('low').attr('value')),
          end_date = parseDate(el.tag('high').attr('value'));
      
      el = entry.template('2.16.840.1.113883.10.20.22.4.4').tag('code');
      var name = el.attr('displayName'),
          code = el.attr('code'),
          code_system = el.attr('codeSystem');
      
      el = entry.template('2.16.840.1.113883.10.20.22.4.6');
      var status = el.tag('value').attr('displayName');
      
      el = entry.template('2.16.840.1.113883.10.20.22.4.31');
      var age = parseInt(el.tag('value').attr('value'));
      
      data.push({
        start_date: start_date,
        end_date: end_date,
        name: name,
        code: code,
        code_system: code_system,
        status: status,
        age: age
      });
    }
    return data;
  };
  
  var processVAC32 = function (xmlDOM) {
    var data = [], el, entries, entry;
    
    el = xmlDOM.template('2.16.840.1.113883.10.20.1.11');
    entries = el.elsByTag('entry');
    
    for (var i = 0; i < entries.length; i++) {
      entry = entries[i];
      
      el = entry.tag('effectiveTime');
      var start_date = parseDate(el.tag('low').attr('value')),
          end_date = parseDate(el.tag('high').attr('value'));
      
      el = entry.template('2.16.840.1.113883.10.20.1.28').tag('code');
      var name = el.tag('originalText').val(),
          code = el.attr('code'),
          code_system = el.attr('codeSystem');
      
      el = entry.template('2.16.840.1.113883.10.20.22.4.6');
      var status = el.tag('value').attr('displayName');
      
      el = entry.template('2.16.840.1.113883.10.20.22.4.31');
      var age = parseInt(el.tag('value').attr('value'));
      
      data.push({
        start_date: start_date,
        end_date: end_date,
        name: name,
        code: code,
        code_system: code_system,
        status: status,
        age: age
      });
    }
    return data;
  };
  
  var processJSON = function (json) {
    return {};
  };
  
  return {
    process: process
  };

}();


// procedures.js

var Procedures = function () {
  
  // dependancies
  var parseDate = Core.parseDate;
  
  // properties
  
  // methods
  var process = function (source, type) {
    var raw, data = [];
    
    switch (type) {
      case 'ccda':
        raw = processCCDA(source);
        break;
      case 'va_c32':
        raw = processVAC32(source);
        break;
      case 'json':
        return processJSON(source);
        break;
    }
    
    for (var i = 0; i < raw.length; i++) {
      data.push({
        date: raw[i].date,
        name: raw[i].name,
        code: raw[i].code,
        code_system: raw[i].code_system,
        specimen: {
          name: raw[i].specimen_name,
          code: raw[i].specimen_code,
          code_system: raw[i].specimen_code_system
        },
        performer: {
          organization: raw[i].organization,
          street: raw[i].street,
          city: raw[i].city,
          state: raw[i].state,
          zip: raw[i].zip,
          country: raw[i].country,
          phone: raw[i].phone
        },
        device: {
          name: raw[i].device_name,
          code: raw[i].device_code,
          code_system: raw[i].device_code_system
        }
      });
    }
    
    return data;
  };
  
  var processCCDA = function (xmlDOM) {
    var data = [], el, els, entries, entry;
    
    el = xmlDOM.template('2.16.840.1.113883.10.20.22.2.7.1');
    entries = el.elsByTag('entry');
    
    for (var i = 0; i < entries.length; i++) {
      entry = entries[i];
      
      el = entry.tag('effectiveTime');
      var date = parseDate(el.attr('value'));
      
      el = entry.tag('code');
      var name = el.attr('displayName'),
          code = el.attr('code'),
          code_system = el.attr('codeSystem');
      
      // 'specimen' tag not always present
      // el = entry.tag('specimen').tag('code');
      // var specimen_name = el.attr('displayName'),
      //     specimen_code = el.attr('code'),
      //     specimen_code_system = el.attr('codeSystem');
      var specimen_name = null,
          specimen_code = null,
          specimen_code_system = null;
      
      el = entry.tag('performer').tag('addr');
      var organization = el.tag('name').val(),
          phone = el.tag('telecom').attr('value');
      
      els = el.elsByTag('streetAddressLine');
      street = [];
      
      for (var j = 0; j < els.length; j++) {
        street.push(els[j].val());
      }
          
      var city = el.tag('city').val(),
          state = el.tag('state').val(),
          zip = el.tag('postalCode').val(),
          country = el.tag('country').val();
      
      // participant => device
      el = entry.tag('participant').tag('code');
      var device_name = el.attr('displayName'),
          device_code = el.attr('code'),
          device_code_system = el.attr('codeSystem');
      
      data.push({
        date: date,
        name: name,
        code: code,
        code_system: code_system,
        specimen_name: specimen_name,
        specimen_code: specimen_code,
        specimen_code_system: specimen_code_system,
        organization: organization,
        phone: phone,
        street: street,
        city: city,
        state: state,
        zip: zip,
        country: country,
        device_name: device_name,
        device_code: device_code,
        device_code_system: device_code_system
      });
    }
    return data;
  };
  
  var processVAC32 = function (xmlDOM) {
    var data = [], el, els, entries, entry;
    
    el = xmlDOM.template('2.16.840.1.113883.10.20.1.12');
    entries = el.elsByTag('entry');
    
    for (var i = 0; i < entries.length; i++) {
      entry = entries[i];
      
      el = entry.tag('effectiveTime');
      var date = parseDate(el.tag('low').attr('value'));
      
      el = entry.tag('code');
      var name = el.tag('originalText').val(),
          code = el.attr('code'),
          code_system = el.attr('codeSystem');
      
      // 'specimen' tag not always present
      // el = entry.tag('specimen').tag('code');
      // var specimen_name = el.attr('displayName'),
      //     specimen_code = el.attr('code'),
      //     specimen_code_system = el.attr('codeSystem');
      var specimen_name = null,
          specimen_code = null,
          specimen_code_system = null;
      
      el = entry.tag('performer').tag('addr');
      var organization = el.tag('name').val(),
          phone = el.tag('telecom').attr('value');
      
      els = el.elsByTag('streetAddressLine');
      street = [];
      
      for (var j = 0; j < els.length; j++) {
        street.push(els[j].val());
      }
          
      var city = el.tag('city').val(),
          state = el.tag('state').val(),
          zip = el.tag('postalCode').val(),
          country = el.tag('country').val();
      
      // participant => device
      el = entry.tag('participant').tag('code');
      var device_name = el.attr('displayName'),
          device_code = el.attr('code'),
          device_code_system = el.attr('codeSystem');
      
      data.push({
        date: date,
        name: name,
        code: code,
        code_system: code_system,
        specimen_name: specimen_name,
        specimen_code: specimen_code,
        specimen_code_system: specimen_code_system,
        organization: organization,
        phone: phone,
        street: street,
        city: city,
        state: state,
        zip: zip,
        country: country,
        device_name: device_name,
        device_code: device_code,
        device_code_system: device_code_system
      });
    }
    return data;
  };
  
  var processJSON = function (json) {
    return {};
  };
  
  return {
    process: process
  };
  
}();


// vitals.js

var Vitals = function () {
  
  // dependancies
  var parseDate = Core.parseDate;
  
  // properties
  
  // methods
  var process = function (source, type) {
    var entries, data = [];
    
    switch (type) {
      case 'ccda':
        entries = processCCDA(source);
        break;
      case 'va_c32':
        entries = processVAC32(source);
        break;
      case 'json':
        return processJSON(source);
        break;
    }
    
    for (var i = 0; i < entries.length; i++) {
      var e = entries[i];
      var entry = {
        date: e.date
      }
      
      var results = [];
      
      for (var j = 0; j < e.results.length; j++) {
        var r = e.results[j];
        results.push({
          name: r.name,
          code: r.code,
          code_system: r.code_system,
          code_system_name: r.code_system_name,
          value: r.value,
          unit: r.unit
        });
      }
      
      entry.results = results;
      data.push(entry);
    }
    
    return data;
  };
  
  var processCCDA = function (xmlDOM) {
    var data = [], results_data = [], el, entries, entry, results, result;
    
    el = xmlDOM.template('2.16.840.1.113883.10.20.22.2.4.1');
    
    entries = el.elsByTag('entry');
    
    for (var i = 0; i < entries.length; i++) {
      entry = entries[i];
      
      el = entry.tag('effectiveTime');
      var entry_date = parseDate(el.attr('value'));
      
      results = entry.elsByTag('component');
      
      for (var j = 0; j < results.length; j++) {
        result = results[j];
        
        // Results
        
        el = result.tag('code');
        var name = el.attr('displayName'),
            code = el.attr('code'),
            code_system = el.attr('codeSystem'),
            code_system_name = el.attr('codeSystemName');
        
        el = result.tag('value');
        var value = parseInt(el.attr('value')),
            unit = el.attr('unit');
        
        results_data.push({
          name: name,
          code: code,
          code_system: code_system,
          code_system_name: code_system_name,
          value: value,
          unit: unit
        });
      }
      
      data.push({
        date: entry_date,
        results: results_data
      });
    }
    return data;
  };
  
  var processVAC32 = function (xmlDOM) {
    var data = [], results_data = [], el, entries, entry, results, result;
    
    el = xmlDOM.template('2.16.840.1.113883.10.20.1.16');
    
    entries = el.elsByTag('entry');
    
    for (var i = 0; i < entries.length; i++) {
      entry = entries[i];
      
      el = entry.tag('effectiveTime');
      var date = parseDate(el.attr('value'));
      
      results = entry.elsByTag('component');
      
      for (var j = 0; j < results.length; j++) {
        result = results[j];
        
        // Results
        
        el = result.tag('code');
        var name = el.attr('displayName'),
            code = el.attr('code'),
            code_system = el.attr('codeSystem'),
            code_system_name = el.attr('codeSystemName');
        
        el = result.tag('value');
        var value = parseInt(el.attr('value')),
            unit = el.attr('unit');
        
        results_data.push({
          name: name,
          code: code,
          code_system: code_system,
          code_system_name: code_system_name,
          value: value,
          unit: unit
        });
      }
      
      data.push({
        date: date,
        results: results_data
      });
    }
    return data;
  };
  
  var processJSON = function (json) {
    return {};
  };
  
  return {
    process: process
  };
  
}();


// bluebutton.js - The Public Object and Interface

var BlueButton = function (source) {
  // dependancies
  
  // properties
  var xmlDOM = null,
      type = '',
      data = {};
  
  // private methods
  var addMethods = function (objects) {
    for (var i = 0; i < objects.length; i++) {
      objects[i].json = function () { return JSON.stringify(this, null, 2) };
    };
  };
  
  // public methods
  var doc = function () { return data.document };
  var allergies = function () { return data.allergies };
  var demographics = function () { return data.demographics };
  var encounters = function () { return data.encounters };
  var immunizations = function () { return data.immunizations };
  var labs = function () { return data.labs };
  var medications = function () { return data.medications };
  var problems = function () { return data.problems };
  var procedures = function () { return data.procedures };
  var vitals = function () { return data.vitals };
  
  // init
  
  // Parse as XML
  // Remove leading and trailing whitespace
  source = source.replace(/^\s+|\s+$/g,'');
  if (source.substr(0, 5) == "<?xml") {
    xmlDOM = Core.parseXML(source);
    
    // Detect document type (CCDA or VA C32)
    if (xmlDOM.template('1.3.6.1.4.1.19376.1.5.3.1.1.1')
      .el.tagName.toLowerCase() == 'empty') {
      type = 'ccda';
    } else {
      type = 'va_c32';
    }
    
    data.document = { type: type };
    data.allergies = Allergies.process(xmlDOM, type);
    data.demographics  = Demographics.process(xmlDOM, type);
    data.encounters = Encounters.process(xmlDOM, type);
    data.immunizations = Immunizations.process(xmlDOM, type);
    data.labs = Labs.process(xmlDOM, type);
    data.medications = Medications.process(xmlDOM, type);
    data.problems = Problems.process(xmlDOM, type);
    data.procedures = Procedures.process(xmlDOM, type);
    data.vitals = Vitals.process(xmlDOM, type);
    
    addMethods([
      data,
      data.document,
      data.allergies,
      data.demographics,
      data.encounters,
      data.immunizations,
      data.labs,
      data.medications,
      data.problems,
      data.procedures,
      data.vitals
    ]);
    
  // parse as JSON
  } else {
    type = 'json';
    
    try {
      var json = JSON.parse(source);
    } catch (e) {
      console.log("BB Exception: Could not parse JSON");
    }
    
    data.document = { type: type };
    data.allergies = Allergies.process(json, type);
    data.demographics  = Demographics.process(json, type);
    data.encounters = Encounters.process(json, type);
    data.immunizations = Immunizations.process(json, type);
    data.labs = Labs.process(json, type);
    data.medications = Medications.process(json, type);
    data.problems = Problems.process(json, type);
    data.procedures = Procedures.process(json, type);
    data.vitals = Vitals.process(json, type);
  }
  
  return {
    data: data,
    xmlDOM: xmlDOM,
    document: doc,
    allergies: allergies,
    demographics: demographics,
    encounters: encounters,
    immunizations: immunizations,
    labs: labs,
    medications: medications,
    problems: problems,
    procedures: procedures,
    vitals: vitals
  };
  
};

window.BlueButton = BlueButton;
  </script>
  <script>
    var xml = document.getElementById('xml').value;
    var bb = BlueButton(xml);
    var el = document.getElementById('result');
    el.innerHTML = bb.data.json();
  </script>
</body>
</html>
