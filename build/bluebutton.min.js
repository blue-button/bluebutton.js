/* BlueButton.js -- 0.0.14 */

!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.BlueButton=b()}(this,function(){var a=function(){var a=this,b=void 0,c=!1,d=a.document;"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(c=!0,b=require("jsdom"),d=new(b.level(1,"core").Document));var e=function(a){return{el:a,template:j,tag:k,elsByTag:l,attr:m,val:n,isEmpty:o}},f=function(a){if(!a||"string"!=typeof a)return console.log("BB Error: XML data is not a string"),null;var d;if(c)d=b.jsdom(a,b.level(1,"core"));else if(window.DOMParser)parser=new DOMParser,d=parser.parseFromString(a,"text/xml");else try{d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(a)}catch(e){console.log("BB ActiveX Exception: Could not parse XML")}return d&&d.documentElement&&!d.getElementsByTagName("parsererror").length?g(d):(console.log("BB Error: Could not parse XML"),null)},g=function(a){if(a.length){for(var b=[],c=0;c<a.length;c++)b.push(e(a[c]));return b}return e(a)},h=function(){var a=d.createElement("empty");return g(a)},i=function(a,b,d,e){a=a.getElementsByTagName(b);for(var f=0;f<a.length;f++)if(d=c?d.toLowerCase():d,a[f].getAttribute(d)===e)return a[f]},j=function(a){var b=i(this.el,"templateId","root",a);return b?g(b.parentNode):h()},k=function(a){var b=this.el.getElementsByTagName(a)[0];return b?g(b):h()},l=function(a){return g(this.el.getElementsByTagName(a))},m=function(a){return this.el?(a=c?a.toLowerCase():a,this.el.getAttribute(a)):null},n=function(){if(!this.el)return null;try{return this.el.childNodes[0].nodeValue}catch(a){return null}},o=function(){return"empty"==this.el.tagName.toLowerCase()?!0:!1},p=function(a){if(!a||"string"!=typeof a)return console.log("Error: date is not a string"),null;var b=a.substr(0,4),c=parseInt(a.substr(4,2),10)-1,d=a.substr(6,2);return new Date(b,c,d)},q=function(a){var b;for(var c in a)b=a[c],null===b&&delete a[c],b instanceof Object&&(b=q(b));return a};return{parseXML:f,parseDate:p,trim:q}}();!function(){return{}}();var b=function(){var b=a.parseDate,c=function(a,b){var c,g=[];switch(b){case"ccda":c=d(a);break;case"va_c32":c=e(a);break;case"json":return f(a)}for(var h=0;h<c.length;h++)g.push({date_range:{start:c[h].start_date,end:c[h].end_date},name:c[h].name,code:c[h].code,code_system:c[h].code_system,code_system_name:c[h].code_system_name,status:c[h].status,severity:c[h].severity,reaction:{name:c[h].reaction_name,code:c[h].reaction_code,code_system:c[h].reaction_code_system},reaction_type:{name:c[h].reaction_type_name,code:c[h].reaction_type_code,code_system:c[h].reaction_code_system,code_system_name:c[h].reaction_type_code_system_name},allergen:{name:c[h].allergen_name,code:c[h].allergen_code,code_system:c[h].allergen_code_system,code_system_name:c[h].allergen_code_system_name}});return g},d=function(a){var c,d,e,f=[];c=a.template("2.16.840.1.113883.10.20.22.2.6.1"),d=c.elsByTag("entry");for(var g=0;g<d.length;g++){e=d[g],c=e.tag("effectiveTime");var h=b(c.tag("low").attr("value")),i=b(c.tag("high").attr("value"));c=e.template("2.16.840.1.113883.10.20.22.4.7").tag("code");var j=c.attr("displayName"),k=c.attr("code"),l=c.attr("codeSystem"),m=c.attr("codeSystemName");c=e.template("2.16.840.1.113883.10.20.22.4.7").tag("value");var n=c.attr("displayName"),o=c.attr("code"),p=c.attr("codeSystem"),q=c.attr("codeSystemName");c=e.template("2.16.840.1.113883.10.20.22.4.9").tag("value");var r=c.attr("displayName"),s=c.attr("code"),t=c.attr("codeSystem");c=e.template("2.16.840.1.113883.10.20.22.4.8").tag("value");var u=c.attr("displayName");c=e.tag("participant").tag("code");var v=c.attr("displayName"),w=c.attr("code"),x=c.attr("codeSystem"),y=c.attr("codeSystemName");c=e.template("2.16.840.1.113883.10.20.22.4.28").tag("value"),c.attr("displayName"),f.push({name:j,start_date:h,end_date:i,code:k,code_system:l,code_system_name:m,reaction_type_name:n,reaction_type_code:o,reaction_type_code_system:p,reaction_type_code_system_name:q,reaction_name:r,reaction_code:s,reaction_code_system:t,severity:u,allergen_name:v,allergen_code:w,allergen_code_system:x,allergen_code_system_name:y})}return f},e=function(a){var b,c,d,e=[];b=a.template("2.16.840.1.113883.3.88.11.83.102"),c=b.elsByTag("entry");for(var f=0;f<c.length;f++){d=c[f],b=d.tag("effectiveTime");var g=b.tag("low").attr("value"),h=b.tag("high").attr("value");b=d.template("2.16.840.1.113883.10.20.1.28").tag("code");var i=b.tag("originalText").val(),j=b.attr("code"),k=b.attr("codeSystem"),l=b.attr("codeSystemName");b=d.template("2.16.840.1.113883.10.20.1.54").tag("value");var m=b.attr("displayName"),n=b.attr("code"),o=b.attr("codeSystem"),p=b.attr("codeSystemName");b=d.template("2.16.840.1.113883.10.20.1.54").tag("value");var q=b.attr("displayName"),r=b.attr("code"),s=b.attr("codeSystem");b=d.template("2.16.840.1.113883.10.20.1.55").tag("value");var t=b.attr("displayName");b=d.tag("participant").tag("code");var u=d.tag("participant").tag("name").val(),v=b.attr("code"),w=b.attr("codeSystem"),x=b.attr("codeSystemName");b=d.template("2.16.840.1.113883.10.20.22.4.28").tag("value"),b.attr("displayName"),e.push({name:i,start_date:g,end_date:h,code:j,code_system:k,code_system_name:l,reaction_type_name:m,reaction_type_code:n,reaction_type_code_system:o,reaction_type_code_system_name:p,reaction_name:q,reaction_code:r,reaction_code_system:s,severity:t,allergen_name:u,allergen_code:v,allergen_code_system:w,allergen_code_system_name:x})}return e},f=function(){return{}};return{process:c}}(),c=function(){var b=a.parseDate,c=function(a,b){var c;switch(b){case"ccda":c=d(a);break;case"va_c32":c=e(a);break;case"json":return f(a)}return{name:{prefix:c.prefix,given:c.given,family:c.family},dob:c.dob,gender:c.gender,marital_status:c.marital_status,address:{street:c.street,city:c.city,state:c.state,zip:c.zip,country:c.country},phone:{home:c.home,work:c.work,mobile:c.mobile},email:c.email,language:c.language,race:c.race,ethnicity:c.ethnicity,religion:c.religion,birthplace:{state:c.birthplace_state,zip:c.birthplace_zip,country:c.birthplace_country},guardian:{name:{given:c.guardian_given,family:c.guardian_family},relationship:c.guardian_relationship,address:{street:c.guardian_street,city:c.guardian_city,state:c.guardian_state,zip:c.guardian_zip,country:c.guardian_country},phone:{home:c.guardian_home}},provider:{organization:c.provider_organization,phone:c.provider_phone,address:{street:c.provider_street,city:c.provider_city,state:c.provider_state,zip:c.provider_zip,country:c.provider_country}}}},d=function(a){var c,d,e,f={};c=a.template("2.16.840.1.113883.10.20.22.1.1"),e=c.tag("patientRole"),c=e.tag("patient").tag("name"),f.prefix=c.tag("prefix").val(),d=c.elsByTag("given"),f.given=[];for(var g=0;g<d.length;g++)f.given.push(d[g].val());f.family=c.tag("family").val(),c=e.tag("patient"),f.dob=b(c.tag("birthTime").attr("value"));var h=c.tag("administrativeGenderCode").attr("code"),i={M:"Male",F:"Female",U:"Undifferentiated"};f.gender=i[h]||null,f.marital_status=c.tag("maritalStatusCode").attr("displayName"),c=e.tag("addr"),d=c.elsByTag("streetAddressLine"),f.street=[];for(var g=0;g<d.length;g++)f.street.push(d[g].val());f.city=c.tag("city").val(),f.state=c.tag("state").val(),f.zip=c.tag("postalCode").val(),f.country=c.tag("country").val(),c=e.tag("telecom"),f.home=c.attr("value"),f.work=null,f.mobile=null,f.email=null,f.language=e.tag("languageCommunication").tag("languageCode").attr("code"),f.race=e.tag("raceCode").attr("displayName"),f.ethnicity=e.tag("ethnicGroupCode").attr("displayName"),f.religion=e.tag("religiousAffiliationCode").attr("displayName"),c=e.tag("birthplace"),f.birthplace_state=c.tag("state").val(),f.birthplace_zip=c.tag("postalCode").val(),f.birthplace_country=c.tag("country").val(),c=e.tag("guardian"),f.guardian_relationship=c.tag("code").attr("displayName"),f.guardian_home=c.tag("telecom").attr("value"),c=c.tag("guardianPerson"),d=c.elsByTag("given"),f.guardian_given=[];for(var g=0;g<d.length;g++)f.guardian_given.push(d[g].val());f.guardian_family=c.tag("family").val(),c=e.tag("guardian").tag("addr"),d=c.elsByTag("streetAddressLine"),f.guardian_street=[];for(var g=0;g<d.length;g++)f.guardian_street.push(d[g].val());f.guardian_city=c.tag("city").val(),f.guardian_state=c.tag("state").val(),f.guardian_zip=c.tag("postalCode").val(),f.guardian_country=c.tag("country").val(),c=e.tag("providerOrganization"),f.provider_organization=c.tag("name").val(),f.provider_phone=c.tag("telecom").attr("value"),d=c.elsByTag("streetAddressLine"),f.provider_street=[];for(var g=0;g<d.length;g++)f.provider_street.push(d[g].val());return f.provider_city=c.tag("city").val(),f.provider_state=c.tag("state").val(),f.provider_zip=c.tag("postalCode").val(),f.provider_country=c.tag("country").val(),f},e=function(a){var c,d,e,f={};c=a.template("1.3.6.1.4.1.19376.1.5.3.1.1.1"),e=c.tag("patientRole"),c=e.tag("patient").tag("name"),f.prefix=c.tag("prefix").val(),d=c.elsByTag("given"),f.given=[];for(var g=0;g<d.length;g++)f.given.push(d[g].val());f.family=c.tag("family").val(),c=e.tag("patient"),f.dob=b(c.tag("birthTime").attr("value")),f.gender=c.tag("administrativeGenderCode").attr("displayName"),f.marital_status=c.tag("maritalStatusCode").attr("displayName"),c=e.tag("addr"),d=c.elsByTag("streetAddressLine"),f.street=[];for(var g=0;g<d.length;g++)f.street.push(d[g].val());f.city=c.tag("city").val(),f.state=c.tag("state").val(),f.zip=c.tag("postalCode").val(),f.country=c.tag("country").val(),c=e.tag("telecom"),f.home=c.attr("value"),f.work=null,f.mobile=null,f.email=null,f.language=e.tag("languageCommunication").tag("languageCode").attr("code"),f.race=e.tag("raceCode").attr("displayName"),f.ethnicity=e.tag("ethnicGroupCode").attr("displayName"),f.religion=e.tag("religiousAffiliationCode").attr("displayName"),c=e.tag("birthplace"),f.birthplace_state=c.tag("state").val(),f.birthplace_zip=c.tag("postalCode").val(),f.birthplace_country=c.tag("country").val(),c=e.tag("guardian"),f.guardian_relationship=c.tag("code").attr("displayName"),f.guardian_home=c.tag("telecom").attr("value"),c=c.tag("guardianPerson"),d=c.elsByTag("given"),f.guardian_given=[];for(var g=0;g<d.length;g++)f.guardian_given.push(d[g].val());f.guardian_family=c.tag("family").val(),c=e.tag("guardian").tag("addr"),d=c.elsByTag("streetAddressLine"),f.guardian_street=[];for(var g=0;g<d.length;g++)f.guardian_street.push(d[g].val());f.guardian_city=c.tag("city").val(),f.guardian_state=c.tag("state").val(),f.guardian_zip=c.tag("postalCode").val(),f.guardian_country=c.tag("country").val(),c=e.tag("providerOrganization"),f.provider_organization=c.tag("name").val(),f.provider_phone=c.tag("telecom").attr("value"),d=c.elsByTag("streetAddressLine"),f.provider_street=[];for(var g=0;g<d.length;g++)f.provider_street.push(d[g].val());return f.provider_city=c.tag("city").val(),f.provider_state=c.tag("state").val(),f.provider_zip=c.tag("postalCode").val(),f.provider_country=c.tag("country").val(),f},f=function(){return{}};return{process:c}}(),d=function(){var b=a.parseDate,c=function(a,b){var c,g=[];switch(b){case"ccda":c=d(a);break;case"va_c32":c=e(a);break;case"json":return f(a)}for(var h=0;h<c.length;h++)g.push({date:c[h].date,name:c[h].name,code:c[h].code,code_system:c[h].code_system,code_system_name:c[h].code_system_name,code_system_version:c[h].code_system_version,finding:{name:c[h].finding_name,code:c[h].finding_code,code_system:c[h].finding_code_system},translation:{name:c[h].translation_name,code:c[h].translation_code,code_system:c[h].translation_code_system,code_system_name:c[h].translation_code_system_name},performer:{name:c[h].performer_name,code:c[h].performer_code,code_system:c[h].performer_code_system,code_system_name:c[h].performer_code_system_name},location:{organization:c[h].organization,street:c[h].street,city:c[h].city,state:c[h].state,zip:c[h].zip,country:c[h].country}});return g},d=function(a){var c,d,e,f,g=[];c=a.template("2.16.840.1.113883.10.20.22.2.22"),c.isEmpty()&&(c=a.template("2.16.840.1.113883.10.20.22.2.22.1")),e=c.elsByTag("entry");for(var h=0;h<e.length;h++){f=e[h];var i=b(f.tag("effectiveTime").attr("value"));c=f.tag("code");var j=c.attr("displayName"),k=c.attr("code"),l=c.attr("codeSystem"),m=c.attr("codeSystemName"),n=c.attr("codeSystemVersion");c=f.tag("value");var o=c.attr("displayName"),p=c.attr("code"),q=c.attr("codeSystem");c=f.tag("translation");var r=c.attr("displayName"),s=c.attr("code"),t=c.attr("codeSystem"),u=c.attr("codeSystemName");c=f.tag("performer").tag("code");var v=c.attr("displayName"),w=(c.attr("code"),c.attr("codeSystem")),x=c.attr("codeSystemName");c=f.tag("participant");var y=c.tag("code").attr("displayName");d=c.elsByTag("streetAddressLine"),street=[];for(var z=0;z<d.length;z++)street.push(d[z].val());var A=c.tag("city").val(),B=c.tag("state").val(),C=c.tag("postalCode").val(),D=c.tag("country").val();g.push({date:i,name:j,code:k,code_system:l,code_system_name:m,code_system_version:n,finding_name:o,finding_code:p,finding_code_system:q,translation_name:r,translation_code:s,translation_code_system:t,translation_code_system_name:u,performer_name:v,performer_code_system:w,performer_code_system_name:x,organization:y,street:street,city:A,state:B,zip:C,country:D})}return g},e=function(a){var c,d,e,f,g=[];c=a.template("2.16.840.1.113883.10.20.1.3"),e=c.elsByTag("entry");for(var h=0;h<e.length;h++){f=e[h];var i=b(f.tag("effectiveTime").tag("low").attr("value"));c=f.tag("code");var j=c.attr("displayName"),k=c.attr("code"),l=c.attr("codeSystem"),m=c.attr("codeSystemName"),n=c.attr("codeSystemVersion");c=f.tag("value");var o=c.attr("displayName"),p=c.attr("code"),q=c.attr("codeSystem");c=f.tag("translation");var r=c.attr("displayName"),s=c.attr("code"),t=c.attr("codeSystem"),u=c.attr("codeSystemName");c=f.tag("performer").tag("code");var v=c.attr("displayName"),w=(c.attr("code"),c.attr("codeSystem")),x=c.attr("codeSystemName");c=f.tag("participant");var y=c.tag("code").attr("displayName");d=c.elsByTag("streetAddressLine"),street=[];for(var z=0;z<d.length;z++)street.push(d[z].val());var A=c.tag("city").val(),B=c.tag("state").val(),C=c.tag("postalCode").val(),D=c.tag("country").val();g.push({date:i,name:j,code:k,code_system:l,code_system_name:m,code_system_version:n,finding_name:o,finding_code:p,finding_code_system:q,translation_name:r,translation_code:s,translation_code_system:t,translation_code_system_name:u,performer_name:v,performer_code_system:w,performer_code_system_name:x,organization:y,street:street,city:A,state:B,zip:C,country:D})}return g},f=function(){return{}};return{process:c}}(),e=function(){var b=a.parseDate,c=function(a,b){var c,g=[];switch(b){case"ccda":c=d(a);break;case"va_c32":c=e(a);break;case"json":return f(a)}for(var h=0;h<c.length;h++)g.push({date:c[h].date,product:{name:c[h].product_name,code:c[h].product_code,code_system:c[h].product_code_system,code_system_name:c[h].product_code_system_name,translation:{name:c[h].translation_name,code:c[h].translation_code,code_system:c[h].translation_code_system,code_system_name:c[h].translation_code_system_name}},route:{name:c[h].route_name,code:c[h].route_code,code_system:c[h].route_code_system,code_system_name:c[h].route_code_system_name},instructions:c[h].instructions_text,education_type:{name:c[h].education_name,code:c[h].education_code,code_system:c[h].education_code_system}});return g},d=function(a){var c,d,e,f=[];c=a.template("2.16.840.1.113883.10.20.22.2.2.1"),c.isEmpty()&&(c=a.template("2.16.840.1.113883.10.20.22.2.2")),d=c.elsByTag("entry");for(var g=0;g<d.length;g++){e=d[g],c=e.tag("effectiveTime");var h=b(c.attr("value"));c=e.template("2.16.840.1.113883.10.20.22.4.54").tag("code");var i=c.attr("displayName"),j=c.attr("code"),k=c.attr("codeSystem"),l=c.attr("codeSystemName");c=e.template("2.16.840.1.113883.10.20.22.4.54").tag("translation");var m=c.attr("displayName"),n=c.attr("code"),o=c.attr("codeSystem"),p=c.attr("codeSystemName");c=e.tag("routeCode");var q=c.attr("displayName"),r=c.attr("code"),s=c.attr("codeSystem"),t=c.attr("codeSystemName");c=e.template("2.16.840.1.113883.10.20.22.4.20");var u=c.tag("text").val();c=c.tag("code");var v=c.attr("displayName"),w=c.attr("code"),x=c.attr("codeSystem");f.push({date:h,product_name:i,product_code:j,product_code_system:k,product_code_system_name:l,translation_name:m,translation_code:n,translation_code_system:o,translation_code_system_name:p,route_name:q,route_code:r,route_code_system:s,route_code_system_name:t,instructions_text:u,education_name:v,education_code:w,education_code_system:x})}return f},e=function(a){var c,d,e,f=[];c=a.template("2.16.840.1.113883.10.20.1.6"),d=c.elsByTag("entry");for(var g=0;g<d.length;g++){e=d[g],c=e.tag("effectiveTime");var h=b(c.attr("value"));c=e.template("2.16.840.1.113883.10.20.1.53").tag("code");var i=c.attr("displayName"),j=c.attr("code"),k=c.attr("codeSystem"),l=c.attr("codeSystemName");c=e.template("2.16.840.1.113883.10.20.22.4.54").tag("translation");var m=c.attr("displayName"),n=c.attr("code"),o=c.attr("codeSystem"),p=c.attr("codeSystemName");c=e.tag("routeCode");var q=c.attr("displayName"),r=c.attr("code"),s=c.attr("codeSystem"),t=c.attr("codeSystemName");c=e.template("2.16.840.1.113883.10.20.22.4.20");var u=c.tag("text").val();c=c.tag("code");var v=c.attr("displayName"),w=c.attr("code"),x=c.attr("codeSystem");f.push({date:h,product_name:i,product_code:j,product_code_system:k,product_code_system_name:l,translation_name:m,translation_code:n,translation_code_system:o,translation_code_system_name:p,route_name:q,route_code:r,route_code_system:s,route_code_system_name:t,instructions_text:u,education_name:v,education_code:w,education_code_system:x})}return f},f=function(){return{}};return{process:c}}(),f=function(){var b=a.parseDate,c=function(a,b){var c,g=[];switch(b){case"ccda":c=d(a);break;case"va_c32":c=e(a);break;case"json":return f(a)}for(var h=0;h<c.length;h++){for(var i=c[h],j={name:i.name,code:i.code,code_system:i.code_system,code_system_name:i.code_system_name},k=[],l=0;l<i.results.length;l++){var m=i.results[l];k.push({date:m.date,name:m.name,value:m.value,unit:m.unit,code:m.code,code_system:m.code_system,code_system_name:m.code_system_name,reference:{low:m.reference_low,high:m.reference_high}})}j.results=k,g.push(j)}return g},d=function(a){var c,d,e,f,g,h,i=[];d=a.template("2.16.840.1.113883.10.20.22.2.3.1"),e=d.elsByTag("entry");for(var j=0;j<e.length;j++){f=e[j],d=f.tag("code");var k=d.attr("displayName"),l=d.attr("code"),m=d.attr("codeSystem"),n=d.attr("codeSystemName");g=f.elsByTag("component"),c=[];for(var o=0;o<g.length;o++){h=g[o];var p=b(h.tag("effectiveTime").attr("value"));d=h.tag("code");var q=d.attr("displayName"),r=d.attr("code"),s=d.attr("codeSystem"),t=d.attr("codeSystemName");d=h.tag("value");var u=parseInt(d.attr("value")),v=d.attr("unit");reference_low=null,reference_high=null,c.push({date:p,name:q,value:u,unit:v,code:r,code_system:s,code_system_name:t,reference_low:reference_low,reference_high:reference_high})}i.push({name:k,code:l,code_system:m,code_system_name:n,results:c})}return i},e=function(a){var c,d,e,f,g,h=[],i=[];c=a.template("2.16.840.1.113883.10.20.1.14"),d=c.elsByTag("entry");for(var j=0;j<d.length;j++){e=d[j],c=e.tag("code");var k=c.attr("displayName"),l=c.attr("code"),m=c.attr("codeSystem"),n=c.attr("codeSystemName");f=e.elsByTag("component");for(var o=0;o<f.length;o++){g=f[o];var p=b(g.tag("effectiveTime").attr("value"));c=g.tag("code");var q=c.tag("originalText").val(),r=c.attr("code"),s=c.attr("codeSystem"),t=c.attr("codeSystemName");c=g.tag("value");var u=parseInt(c.attr("value")),v=c.attr("unit");reference_low=null,reference_high=null,i.push({date:p,name:q,value:u,unit:v,code:r,code_system:s,code_system_name:t,reference_low:reference_low,reference_high:reference_high})}h.push({name:k,code:l,code_system:m,code_system_name:n,results:i})}return h},f=function(){return{}};return{process:c}}(),g=function(){var b=a.parseDate,c=function(a,b){var c,g=[];switch(b){case"ccda":c=d(a);break;case"va_c32":c=e(a);break;case"json":return f(a)}for(var h=0;h<c.length;h++)g.push({date_range:{start:c[h].start_date,end:c[h].end_date},product:{name:c[h].product_name,code:c[h].product_code,code_system:c[h].product_code_system,translation:{name:c[h].translation_name,code:c[h].translation_code,code_system:c[h].translation_code_system,code_system_name:c[h].translation_code_system_name}},dose_quantity:{value:c[h].dose_value,unit:c[h].dose_unit},rate_quantity:{value:c[h].rate_quantity_value,unit:c[h].rate_quantity_unit},precondition:{name:c[h].precondition_name,code:c[h].precondition_code,code_system:c[h].precondition_code_system},reason:{name:c[h].reason_name,code:c[h].reason_code,code_system:c[h].reason_code_system},route:{name:c[h].route_name,code:c[h].route_code,code_system:c[h].route_code_system,code_system_name:c[h].route_code_system_name},vehicle:{name:c[h].vehicle_name,code:c[h].vehicle_code,code_system:c[h].vehicle_code_system,code_system_name:c[h].vehicle_code_system_name},administration:{name:c[h].administration_name,code:c[h].administration_code,code_system:c[h].administration_code_system,code_system_name:c[h].administration_code_system_name},prescriber:{organization:c[h].prescriber_organization,person:c[h].prescriber_person}});return g},d=function(a){var c,d,e,f=[];c=a.template("2.16.840.1.113883.10.20.22.2.1.1"),d=c.elsByTag("entry");for(var g=0;g<d.length;g++){e=d[g],c=e.tag("effectiveTime");var h=b(c.tag("low").attr("value")),i=b(c.tag("high").attr("value"));c=e.tag("manufacturedProduct").tag("code");var j=c.attr("displayName"),k=c.attr("code"),l=c.attr("codeSystem");c=e.tag("manufacturedProduct").tag("translation");var m=c.attr("displayName"),n=c.attr("code"),o=c.attr("codeSystem"),p=c.attr("codeSystemName");c=e.tag("doseQuantity");var q=c.attr("value"),r=c.attr("unit");c=e.tag("rateQuantity");var s=c.attr("value"),t=c.attr("unit");c=e.tag("precondition").tag("value");var u=c.attr("displayName"),v=c.attr("code"),w=c.attr("codeSystem"),c=e.template("2.16.840.1.113883.10.20.22.4.19").tag("value"),x=c.attr("displayName"),y=c.attr("code"),z=c.attr("codeSystem");c=e.tag("routeCode");var A=c.attr("displayName"),B=c.attr("code"),C=c.attr("codeSystem"),D=c.attr("codeSystemName");c=e.tag("participant").tag("code");var E=c.attr("displayName"),F=c.attr("code"),G=c.attr("codeSystem"),H=c.attr("codeSystemName");c=e.tag("administrationUnitCode");var I=c.attr("displayName"),J=c.attr("code"),K=c.attr("codeSystem"),L=c.attr("codeSystemName");c=e.tag("performer");var M=c.tag("name").val(),N=null;f.push({start_date:h,end_date:i,product_name:j,product_code:k,product_code_system:l,translation_name:m,translation_code:n,translation_code_system:o,translation_code_system_name:p,dose_value:q,dose_unit:r,rate_quantity_value:s,rate_quantity_unit:t,precondition_name:u,precondition_code:v,precondition_code_system:w,reason_name:x,reason_code:y,reason_code_system:z,route_name:A,route_code:B,route_code_system:C,route_code_system_name:D,vehicle_name:E,vehicle_code:F,vehicle_code_system:G,vehicle_code_system_name:H,administration_name:I,administration_code:J,administration_code_system:K,administration_code_system_name:L,prescriber_organization:M,prescriber_person:N})}return f},e=function(a){var c,d,e,f=[];c=a.template("2.16.840.1.113883.3.88.11.83.112"),d=c.elsByTag("entry");for(var g=0;g<d.length;g++){e=d[g],c=e.tag("effectiveTime");var h=b(c.tag("low").attr("value")),i=b(c.tag("high").attr("value"));c=e.tag("manufacturedProduct").tag("code");var j=c.attr("displayName"),k=c.attr("code"),l=c.attr("codeSystem");c=e.tag("manufacturedProduct").tag("translation");var m=c.attr("displayName"),n=c.attr("code"),o=c.attr("codeSystem"),p=c.attr("codeSystemName");c=e.tag("doseQuantity");var q=c.attr("value"),r=c.attr("unit");c=e.tag("rateQuantity");var s=c.attr("value"),t=c.attr("unit");c=e.tag("precondition").tag("value");var u=c.attr("displayName"),v=c.attr("code"),w=c.attr("codeSystem"),c=e.template("2.16.840.1.113883.10.20.22.4.19").tag("value"),x=c.attr("displayName"),y=c.attr("code"),z=c.attr("codeSystem");c=e.tag("routeCode");var A=c.attr("displayName"),B=c.attr("code"),C=c.attr("codeSystem"),D=c.attr("codeSystemName");c=e.tag("participant").tag("code");var E=c.attr("displayName"),F=c.attr("code"),G=c.attr("codeSystem"),H=c.attr("codeSystemName");c=e.tag("administrationUnitCode");var I=c.attr("displayName"),J=c.attr("code"),K=c.attr("codeSystem"),L=c.attr("codeSystemName");c=e.tag("performer");var M=c.tag("name").val(),N=null;f.push({start_date:h,end_date:i,product_name:j,product_code:k,product_code_system:l,translation_name:m,translation_code:n,translation_code_system:o,translation_code_system_name:p,dose_value:q,dose_unit:r,rate_quantity_value:s,rate_quantity_unit:t,precondition_name:u,precondition_code:v,precondition_code_system:w,reason_name:x,reason_code:y,reason_code_system:z,route_name:A,route_code:B,route_code_system:C,route_code_system_name:D,vehicle_name:E,vehicle_code:F,vehicle_code_system:G,vehicle_code_system_name:H,administration_name:I,administration_code:J,administration_code_system:K,administration_code_system_name:L,prescriber_organization:M,prescriber_person:N})}return f},f=function(){return{}};return{process:c}}(),h=function(){var b=a.parseDate,c=function(a,b){var c,g=[];switch(b){case"ccda":c=d(a);break;case"va_c32":c=e(a);break;case"json":return f(a)}for(var h=0;h<c.length;h++)g.push({date_range:{start:c[h].start_date,end:c[h].end_date},name:c[h].name,status:c[h].status,age:c[h].age,code:c[h].code,code_system:c[h].code_system});return g},d=function(a){var c,d,e,f=[];c=a.template("2.16.840.1.113883.10.20.22.2.5.1"),c.isEmpty()&&(c=a.template("2.16.840.1.113883.10.20.22.2.5")),d=c.elsByTag("entry");for(var g=0;g<d.length;g++){e=d[g],c=e.tag("effectiveTime");var h=b(c.tag("low").attr("value")),i=b(c.tag("high").attr("value"));c=e.template("2.16.840.1.113883.10.20.22.4.4").tag("code");var j=c.attr("displayName"),k=c.attr("code"),l=c.attr("codeSystem");c=e.template("2.16.840.1.113883.10.20.22.4.6");var m=c.tag("value").attr("displayName");c=e.template("2.16.840.1.113883.10.20.22.4.31");var n=parseInt(c.tag("value").attr("value"));f.push({start_date:h,end_date:i,name:j,code:k,code_system:l,status:m,age:n})}return f},e=function(a){var c,d,e,f=[];c=a.template("2.16.840.1.113883.10.20.1.11"),d=c.elsByTag("entry");for(var g=0;g<d.length;g++){e=d[g],c=e.tag("effectiveTime");var h=b(c.tag("low").attr("value")),i=b(c.tag("high").attr("value"));c=e.template("2.16.840.1.113883.10.20.1.28").tag("code");var j=c.tag("originalText").val(),k=c.attr("code"),l=c.attr("codeSystem");c=e.template("2.16.840.1.113883.10.20.22.4.6");var m=c.tag("value").attr("displayName");c=e.template("2.16.840.1.113883.10.20.22.4.31");var n=parseInt(c.tag("value").attr("value"));f.push({start_date:h,end_date:i,name:j,code:k,code_system:l,status:m,age:n})}return f},f=function(){return{}};return{process:c}}(),i=function(){var b=a.parseDate,c=function(a,b){var c,g=[];switch(b){case"ccda":c=d(a);break;case"va_c32":c=e(a);break;case"json":return f(a)}for(var h=0;h<c.length;h++)g.push({date:c[h].date,name:c[h].name,code:c[h].code,code_system:c[h].code_system,specimen:{name:c[h].specimen_name,code:c[h].specimen_code,code_system:c[h].specimen_code_system},performer:{organization:c[h].organization,street:c[h].street,city:c[h].city,state:c[h].state,zip:c[h].zip,country:c[h].country,phone:c[h].phone},device:{name:c[h].device_name,code:c[h].device_code,code_system:c[h].device_code_system}});return g},d=function(a){var c,d,e,f,g=[];c=a.template("2.16.840.1.113883.10.20.22.2.7.1"),c.isEmpty()&&(c=a.template("2.16.840.1.113883.10.20.22.2.7")),e=c.elsByTag("entry");for(var h=0;h<e.length;h++){f=e[h],c=f.tag("effectiveTime");var i=b(c.attr("value"));c=f.tag("code");var j=c.attr("displayName"),k=c.attr("code"),l=c.attr("codeSystem"),m=null,n=null,o=null;c=f.tag("performer").tag("addr");var p=c.tag("name").val(),q=c.tag("telecom").attr("value");d=c.elsByTag("streetAddressLine"),street=[];for(var r=0;r<d.length;r++)street.push(d[r].val());var s=c.tag("city").val(),t=c.tag("state").val(),u=c.tag("postalCode").val(),v=c.tag("country").val();c=f.tag("participant").tag("code");var w=c.attr("displayName"),x=c.attr("code"),y=c.attr("codeSystem");g.push({date:i,name:j,code:k,code_system:l,specimen_name:m,specimen_code:n,specimen_code_system:o,organization:p,phone:q,street:street,city:s,state:t,zip:u,country:v,device_name:w,device_code:x,device_code_system:y})}return g},e=function(a){var c,d,e,f,g=[];c=a.template("2.16.840.1.113883.10.20.1.12"),e=c.elsByTag("entry");for(var h=0;h<e.length;h++){f=e[h],c=f.tag("effectiveTime");var i=b(c.tag("low").attr("value"));c=f.tag("code");var j=c.tag("originalText").val(),k=c.attr("code"),l=c.attr("codeSystem"),m=null,n=null,o=null;c=f.tag("performer").tag("addr");var p=c.tag("name").val(),q=c.tag("telecom").attr("value");d=c.elsByTag("streetAddressLine"),street=[];for(var r=0;r<d.length;r++)street.push(d[r].val());var s=c.tag("city").val(),t=c.tag("state").val(),u=c.tag("postalCode").val(),v=c.tag("country").val();c=f.tag("participant").tag("code");var w=c.attr("displayName"),x=c.attr("code"),y=c.attr("codeSystem");g.push({date:i,name:j,code:k,code_system:l,specimen_name:m,specimen_code:n,specimen_code_system:o,organization:p,phone:q,street:street,city:s,state:t,zip:u,country:v,device_name:w,device_code:x,device_code_system:y})}return g},f=function(){return{}};return{process:c}}(),j=function(){var b=a.parseDate,c=function(a,b){var c,g=[];switch(b){case"ccda":c=d(a);break;case"va_c32":c=e(a);break;case"json":return f(a)}for(var h=0;h<c.length;h++){for(var i=c[h],j={date:i.date},k=[],l=0;l<i.results.length;l++){var m=i.results[l];k.push({name:m.name,code:m.code,code_system:m.code_system,code_system_name:m.code_system_name,value:m.value,unit:m.unit})}j.results=k,g.push(j)}return g},d=function(a){var c,d,e,f,g,h,i=[];d=a.template("2.16.840.1.113883.10.20.22.2.4.1"),e=d.elsByTag("entry");for(var j=0;j<e.length;j++){f=e[j],d=f.tag("effectiveTime");var k=b(d.attr("value"));g=f.elsByTag("component"),c=[];for(var l=0;l<g.length;l++){h=g[l],d=h.tag("code");var m=d.attr("displayName"),n=d.attr("code"),o=d.attr("codeSystem"),p=d.attr("codeSystemName");d=h.tag("value");var q=parseInt(d.attr("value")),r=d.attr("unit");c.push({name:m,code:n,code_system:o,code_system_name:p,value:q,unit:r})}i.push({date:k,results:c})}return i},e=function(a){var c,d,e,f,g,h=[],i=[];c=a.template("2.16.840.1.113883.10.20.1.16"),d=c.elsByTag("entry");for(var j=0;j<d.length;j++){e=d[j],c=e.tag("effectiveTime");var k=b(c.attr("value"));f=e.elsByTag("component");for(var l=0;l<f.length;l++){g=f[l],c=g.tag("code");var m=c.attr("displayName"),n=c.attr("code"),o=c.attr("codeSystem"),p=c.attr("codeSystemName");c=g.tag("value");var q=parseInt(c.attr("value")),r=c.attr("unit");i.push({name:m,code:n,code_system:o,code_system_name:p,value:q,unit:r})}h.push({date:k,results:i})}return h},f=function(){return{}};return{process:c}}(),k=function(k){var l=null,m="",n={},o=function(a){for(var b=0;b<a.length;b++)a[b].json=function(){return JSON.stringify(this,null,2)}},p=function(){return n.document},q=function(){return n.allergies},r=function(){return n.demographics},s=function(){return n.encounters},t=function(){return n.immunizations},u=function(){return n.labs},v=function(){return n.medications},w=function(){return n.problems},x=function(){return n.procedures},y=function(){return n.vitals};if(k=k.replace(/^\s+|\s+$/g,""),"<?xml"==k.substr(0,5))l=a.parseXML(k),m=l.template("1.3.6.1.4.1.19376.1.5.3.1.1.1").isEmpty()?"ccda":"va_c32",n.document={type:m},n.allergies=b.process(l,m),n.demographics=c.process(l,m),n.encounters=d.process(l,m),n.immunizations=e.process(l,m),n.labs=f.process(l,m),n.medications=g.process(l,m),n.problems=h.process(l,m),n.procedures=i.process(l,m),n.vitals=j.process(l,m),o([n,n.document,n.allergies,n.demographics,n.encounters,n.immunizations,n.labs,n.medications,n.problems,n.procedures,n.vitals]);else{m="json";try{var z=JSON.parse(k)}catch(A){console.log("BB Exception: Could not parse JSON")}n.document={type:m},n.allergies=b.process(z,m),n.demographics=c.process(z,m),n.encounters=d.process(z,m),n.immunizations=e.process(z,m),n.labs=f.process(z,m),n.medications=g.process(z,m),n.problems=h.process(z,m),n.procedures=i.process(z,m),n.vitals=j.process(z,m)
}return{data:n,xmlDOM:l,document:p,allergies:q,demographics:r,encounters:s,immunizations:t,labs:u,medications:v,problems:w,procedures:x,vitals:y}};return k});